<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ³ä¹æ¨èç³»ç»Ÿ</title>
    <style>
        :root {
            --bg-color: #01B3C9;
            --sidebar-color: #7CE4E5;
            --card-color: #4AC8D8;
            --text-color: #FAF8E8;
            --secondary-text: #E8E6D9;
            --accent-color: #FFD83B;
            --active-accent: #FFE45E;
            --sidebar-text: #191814;
            --title-color: #F5F5DC;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.5;
            margin: 0;
            display: grid;
            grid-template-columns: 220px 1fr;
            min-height: 100vh;
        }

        /* å…¨å±€æ’­æ”¾å™¨æ ·å¼ */
        .global-player {
            position: fixed;
            bottom: 0;
            left: 220px;
            right: 0;
            background: var(--card-color);
            padding: 10px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 100;
            display: none;
            transition: transform 0.3s ease;
        }

        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .close-player {
            cursor: pointer;
            color: var(--secondary-text);
            font-size: 18px;
            padding: 5px;
        }

        /* ä¾§è¾¹æ æ ·å¼ */
        .sidebar {
            background-color: var(--sidebar-color);
            color: var(--sidebar-text);
            padding: 20px 0;
        }

        .logo {
            font-size: 20px;
            font-weight: bold;
            text-align: center;
            padding: 20px;
            margin-bottom: 30px;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            color: var(--sidebar-text);
        }

        .nav-menu {
            list-style: none;
            padding: 0;
        }

        .nav-item {
            padding: 12px 25px;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            color: var(--sidebar-text);
        }

        .nav-item:hover {
            background-color: rgba(0,0,0,0.1);
        }

        .nav-item.active {
            background-color: var(--accent-color);
            color: var(--sidebar-color);
        }

        /* ä¸»å†…å®¹åŒºæ ·å¼ */
        .main-content {
            padding: 30px;
            background-color: var(--bg-color);
        }

        /* éŸ³ä¹ç½‘æ ¼å¸ƒå±€ */
        .music-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 20px;
        }

        /* éŸ³ä¹å¡ç‰‡æ ·å¼ */
        .music-card {
            background-color: var(--card-color);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            height: 100%;
            transition: transform 0.3s;
        }

        .music-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.12);
        }

        .album-cover-container {
            position: relative;
            width: 100%;
            height: 240px;
            overflow: hidden;
        }

        .album-cover {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .music-card:hover .album-cover {
            transform: scale(1.05);
        }

        .music-info {
            padding: 15px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .song-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--text-color);
            cursor: pointer;
            transition: color 0.2s;
        }

        .song-title:hover {
            color: var(--accent-color);
        }

        .song-meta {
            font-size: 13px;
            color: var(--secondary-text);
            margin-bottom: 12px;
            flex-grow: 1;
        }

        .play-control {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(255,255,255,0.2);
        }

        .play-btn {
            background-color: var(--accent-color);
            color: var(--sidebar-text);
            border: none;
            padding: 6px 15px;
            border-radius: 15px;
            font-size: 13px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .play-btn:hover {
            background-color: var(--active-accent);
        }

        .favorite-btn {
            background: none;
            border: none;
            color: var(--secondary-text);
            font-size: 16px;
            cursor: pointer;
            padding: 0 8px;
            transition: all 0.2s;
        }

        .favorite-btn.favorited {
            color: #ff4081;
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: var(--card-color);
            margin: 10% auto;
            padding: 20px;
            border-radius: 8px;
            width: 350px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .close {
            color: var(--secondary-text);
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 4px;
            box-sizing: border-box;
            background-color: rgba(255,255,255,0.1);
            color: var(--text-color);
        }

        .form-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
        }

        .btn-primary {
            background-color: var(--accent-color);
            color: var(--sidebar-text);
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-danger {
            background-color: #ff5252;
            color: white;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: var(--accent-color);
            color: var(--sidebar-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .login-btn {
            background: none;
            border: none;
            color: var(--sidebar-text);
            cursor: pointer;
            font-weight: 600;
        }

        .register-btn {
            background: none;
            border: none;
            color: var(--accent-color);
            cursor: pointer;
            font-weight: 600;
        }

        .admin-only {
            display: none;
        }

        /* æ­Œæ›²è¯¦æƒ…æ ·å¼ */
        .back-to-list {
            color: var(--accent-color);
            cursor: pointer;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .song-detail-header {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .song-detail-cover {
            width: 200px;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
        }

        .song-detail-info {
            flex: 1;
        }

        .song-detail-title {
            font-size: 24px;
            margin-bottom: 8px;
            color: var(--text-color);
        }

        .song-detail-artist {
            font-size: 18px;
            margin-bottom: 15px;
            color: var(--secondary-text);
        }

        .song-detail-meta {
            margin-bottom: 20px;
        }

        .song-detail-meta-item {
            margin-bottom: 8px;
            display: flex;
        }

        .song-detail-meta-label {
            font-weight: bold;
            width: 60px;
            color: var(--secondary-text);
        }

        .song-detail-meta-value {
            flex: 1;
        }

        .song-detail-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .song-detail-content {
            margin-top: 30px;
        }

        .song-detail-lyrics {
            white-space: pre-line;
            line-height: 1.8;
            margin-bottom: 30px;
        }

        /* è¯„è®ºåŒºåŸŸæ ·å¼ */
        .comments-section {
            margin-top: 40px;
        }

        .comments-title {
            font-size: 20px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .comment-form {
            margin-bottom: 30px;
        }

        .comment-input {
            width: 100%;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid rgba(255,255,255,0.3);
            background-color: rgba(255,255,255,0.1);
            color: var(--text-color);
            margin-bottom: 10px;
            min-height: 80px;
        }

        .comment-submit {
            background-color: var(--accent-color);
            color: var(--sidebar-text);
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .comment-list {
            list-style: none;
        }

        .comment-item {
            padding: 15px;
            background-color: rgba(255,255,255,0.1);
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .comment-user {
            font-weight: bold;
            color: var(--accent-color);
        }

        .comment-time {
            font-size: 12px;
            color: var(--secondary-text);
        }

        .comment-content {
            margin-bottom: 10px;
        }

        .comment-actions {
            display: flex;
            gap: 10px;
            font-size: 12px;
        }

        .comment-action {
            color: var(--secondary-text);
            cursor: pointer;
        }

        .comment-action:hover {
            color: var(--accent-color);
        }

        /* ç®¡ç†é¢æ¿æ ·å¼ */
        .management-panel {
            display: none;
        }

        .panel-header {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .panel-title {
            font-size: 24px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table th, .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .data-table th {
            background-color: rgba(255,255,255,0.1);
            font-weight: bold;
        }

        .data-table tr:hover {
            background-color: rgba(255,255,255,0.05);
        }

        .action-btn {
            padding: 5px 10px;
            margin-right: 5px;
            border-radius: 3px;
            cursor: pointer;
            border: none;
        }

        .edit-btn {
            background-color: var(--accent-color);
            color: var(--sidebar-text);
        }

        .delete-btn {
            background-color: #ff5252;
            color: white;
        }

        .add-btn {
            background-color: var(--accent-color);
            color: var(--sidebar-text);
            padding: 8px 16px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            margin-bottom: 20px;
        }

        /* æ ‡ç­¾æ ·å¼ */
        .tag {
            display: inline-block;
            padding: 2px 8px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            font-size: 12px;
            margin-right: 5px;
            margin-bottom: 5px;
        }

        /* åˆ‡æ¢è¡¨å•æ ·å¼ */
        .auth-form-toggle {
            text-align: center;
            margin-top: 15px;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            body {
                grid-template-columns: 1fr;
            }
            .sidebar {
                display: none;
            }
            .music-grid {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            }
            .album-cover-container {
                height: 180px;
            }
            .global-player {
                left: 0;
            }
            .modal-content {
                width: 90%;
                margin: 20% auto;
            }
            .song-detail-header {
                flex-direction: column;
            }
            .song-detail-cover {
                width: 100%;
                height: auto;
                max-height: 300px;
            }
        }
    </style>
</head>
<body>
    <!-- å…¨å±€æ’­æ”¾å™¨ -->
    <div class="global-player" id="globalPlayer">
        <div class="player-header">
            <div id="currentPlaying">æ­£åœ¨æ’­æ”¾: <span id="currentSongTitle">--</span> - <span id="currentSongArtist">--</span></div>
            <span class="close-player" onclick="closePlayer()">&times;</span>
        </div>
        <audio controls id="audioPlayer" style="width:100%"></audio>
    </div>

    <!-- ç™»å½•/æ³¨å†Œæ¨¡æ€æ¡† -->
    <div id="authModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAuthModal()">&times;</span>
            <h2 id="modalTitle">ç”¨æˆ·ç™»å½•</h2>
            <form id="authForm">
                <div class="form-group">
                    <label for="username">ç”¨æˆ·å</label>
                    <input type="text" id="username" name="username" required>
                </div>
                <div class="form-group">
                    <label for="password">å¯†ç </label>
                    <input type="password" id="password" name="password" required>
                </div>
                <div id="confirmPasswordGroup" class="form-group" style="display: none;">
                    <label for="confirmPassword">ç¡®è®¤å¯†ç </label>
                    <input type="password" id="confirmPassword" name="confirmPassword">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-primary" id="authSubmitBtn" onclick="submitAuthForm()">ç™»å½•</button>
                </div>
                <div class="auth-form-toggle">
                    <span id="toggleAuthFormText">è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ</span>
                    <button type="button" class="register-btn" id="toggleAuthFormBtn" onclick="toggleAuthForm()">ç«‹å³æ³¨å†Œ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- åˆ†ç±»æ ‡ç­¾ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div id="categoryTagModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCategoryTagModal()">&times;</span>
            <h2 id="categoryTagModalTitle">æ·»åŠ åˆ†ç±»æ ‡ç­¾</h2>
            <form id="categoryTagForm">
                <input type="hidden" id="categoryTagId">
                <div class="form-group">
                    <label for="categoryTagName">åç§°</label>
                    <input type="text" id="categoryTagName" required>
                </div>
                <div class="form-group">
                    <label for="categoryTagType">ç±»å‹</label>
                    <select id="categoryTagType" required>
                        <option value="category">åˆ†ç±»</option>
                        <option value="tag">æ ‡ç­¾</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="categoryTagDescription">æè¿°</label>
                    <textarea id="categoryTagDescription" rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-danger" id="deleteCategoryTagBtn" style="display:none;" onclick="deleteCategoryTag()">åˆ é™¤</button>
                    <button type="button" class="btn btn-primary" onclick="saveCategoryTag()">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <!-- è¯„è®ºç¼–è¾‘æ¨¡æ€æ¡† -->
    <div id="commentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCommentModal()">&times;</span>
            <h2 id="commentModalTitle">ç¼–è¾‘è¯„è®º</h2>
            <form id="commentForm">
                <input type="hidden" id="commentId">
                <input type="hidden" id="commentSongId">
                <div class="form-group">
                    <label for="commentContent">è¯„è®ºå†…å®¹</label>
                    <textarea id="commentContent" rows="5" required></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-danger" onclick="deleteComment()">åˆ é™¤</button>
                    <button type="button" class="btn btn-primary" onclick="saveComment()">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ç”¨æˆ·ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeUserModal()">&times;</span>
            <h2 id="userModalTitle">æ·»åŠ ç”¨æˆ·</h2>
            <form id="userForm">
                <input type="hidden" id="userId">
                <div class="form-group">
                    <label for="userUsername">ç”¨æˆ·å</label>
                    <input type="text" id="userUsername" required>
                </div>
                <div class="form-group">
                    <label for="userEmail">é‚®ç®±</label>
                    <input type="email" id="userEmail" required>
                </div>
                <div class="form-group">
                    <label for="userRole">è§’è‰²</label>
                    <select id="userRole" required>
                        <option value="user">æ™®é€šç”¨æˆ·</option>
                        <option value="admin">ç®¡ç†å‘˜</option>
                        <option value="editor">ç¼–è¾‘</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-danger" id="deleteUserBtn" style="display:none;" onclick="deleteUser()">åˆ é™¤</button>
                    <button type="button" class="btn btn-primary" onclick="saveUser()">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <!-- éŸ³ä¹ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div id="musicModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeMusicModal()">&times;</span>
            <h2 id="musicModalTitle">æ·»åŠ éŸ³ä¹</h2>
            <form id="musicForm">
                <input type="hidden" id="musicId">
                <div class="form-group">
                    <label for="musicTitle">æ­Œæ›²åç§°</label>
                    <input type="text" id="musicTitle" required>
                </div>
                <div class="form-group">
                    <label for="musicArtist">è‰ºæœ¯å®¶</label>
                    <input type="text" id="musicArtist" required>
                </div>
                <div class="form-group">
                    <label for="musicAlbum">ä¸“è¾‘</label>
                    <input type="text" id="musicAlbum" required>
                </div>
                <div class="form-group">
                    <label for="musicCover">å°é¢URL</label>
                    <input type="text" id="musicCover" required>
                </div>
                <div class="form-group">
                    <label for="musicAudio">éŸ³é¢‘URL</label>
                    <input type="text" id="musicAudio" required>
                </div>
                <div class="form-group">
                    <label for="musicDuration">æ—¶é•¿</label>
                    <input type="text" id="musicDuration" required>
                </div>
                <div class="form-group">
                    <label for="musicGenre">æµæ´¾</label>
                    <input type="text" id="musicGenre" required>
                </div>
                <div class="form-group">
                    <label for="musicLyrics">æ­Œè¯</label>
                    <textarea id="musicLyrics" rows="5" required></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-danger" id="deleteMusicBtn" style="display:none;" onclick="deleteMusic()">åˆ é™¤</button>
                    <button type="button" class="btn btn-primary" onclick="saveMusic()">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ä¾§è¾¹å¯¼èˆª -->
    <nav class="sidebar">
        <div class="logo">éŸ³ä¹æ¨èç³»ç»Ÿ</div>
        <div class="user-info" id="userInfo" style="display:none; padding: 0 25px 20px; border-bottom: 1px solid rgba(0,0,0,0.1);">
            <div class="user-avatar" id="userAvatar">A</div>
            <span id="userName">ç®¡ç†å‘˜</span>
            <button class="login-btn" onclick="logout()">é€€å‡º</button>
        </div>
        <div class="user-info" id="guestInfo" style="padding: 0 25px 20px; border-bottom: 1px solid rgba(0,0,0,0.1);">
            <button class="login-btn" onclick="openAuthModal('login')">ç”¨æˆ·ç™»å½•</button>
            <button class="register-btn" onclick="openAuthModal('register')">ç”¨æˆ·æ³¨å†Œ</button>
        </div>
        <ul class="nav-menu">
            <li class="nav-item active" onclick="showPanel('recommendation-panel')">
                <i>ğŸµ</i>éŸ³ä¹æ¨è
            </li>
            <li class="nav-item" onclick="showPanel('favorites-panel')">
                <i>â¤ï¸</i>æˆ‘çš„æ”¶è—
            </li>
            <li class="nav-item admin-only" onclick="showPanel('music-panel')">
                <i>ğŸ¼</i>éŸ³ä¹ç®¡ç†
            </li>
            <li class="nav-item admin-only" onclick="showPanel('category-tag-panel')">
                <i>ğŸ—‚ï¸</i>åˆ†ç±»æ ‡ç­¾ç®¡ç†
            </li>
            <li class="nav-item admin-only" onclick="showPanel('user-panel')">
                <i>ğŸ‘¥</i>ç”¨æˆ·ç®¡ç†
            </li>
            <li class="nav-item admin-only" onclick="showPanel('comment-panel')">
                <i>ğŸ’¬</i>è¯„è®ºç®¡ç†
            </li>
            <li class="nav-item admin-only" onclick="showPanel('operation-panel')">
                <i>ğŸ“Š</i>è¿è¥ç®¡ç†
            </li>
            <li class="nav-item admin-only" onclick="showPanel('log-panel')">
                <i>ğŸ“</i>æ—¥å¿—ç®¡ç†
            </li>
            <li class="nav-item admin-only" onclick="showPanel('system-panel')">
                <i>âš™ï¸</i>ç³»ç»Ÿä¿¡æ¯
            </li>
        </ul>
    </nav>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="main-content">
        <!-- æ¨èé¢æ¿ -->
        <div id="recommendation-panel">
            <div class="recommendation-header">
                <h1 class="recommendation-title">ä»Šæ—¥éŸ³ä¹æ¨è</h1>
                <p class="recommendation-subtitle">å‘ç°æœ€æ–°æœ€çƒ­çš„éŸ³ä¹ä½œå“</p>
            </div>

            <div class="music-grid">
                <!-- ç¤ºä¾‹éŸ³ä¹å¡ç‰‡1 -->
                <div class="music-card">
                    <div class="album-cover-container">
                        <img src="static/covers/our_summer.jpg" alt="Our Summer" class="album-cover">
                    </div>
                    <div class="music-info">
                        <h3 class="song-title" onclick="showSongDetail(1)">Our Summer</h3>
                        <div class="song-meta">
                            <span class="song-artist">TXT</span>
                            <span class="song-album">K-pop</span>
                        </div>
                        <div class="play-control">
                            <span class="duration">3:30</span>
                            <button class="play-btn" onclick="playSong(1, 'Our Summer', 'TXT')">
                                æ’­æ”¾
                            </button>
                            <button class="favorite-btn" onclick="toggleFavorite(1, this)">
                                â™¡
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ç¤ºä¾‹éŸ³ä¹å¡ç‰‡2 -->
                <div class="music-card">
                    <div class="album-cover-container">
                        <img src="static/covers/run_free.jpg" alt="Run Free" class="album-cover">
                    </div>
                    <div class="music-info">
                        <h3 class="song-title" onclick="showSongDetail(2)">Run Free</h3>
                        <div class="song-meta">
                            <span class="song-artist">Deep Chills</span>
                            <span class="song-album">Pop</span>
                        </div>
                        <div class="play-control">
                            <span class="duration">2:50</span>
                            <button class="play-btn" onclick="playSong(2, 'Run Free', 'Deep Chills')">
                                æ’­æ”¾
                            </button>
                            <button class="favorite-btn" onclick="toggleFavorite(2, this)">
                                â™¡
                            </button>
                        </div>
                    </div>
                </div>

                <div class="music-card">
                    <div class="album-cover-container">
                        <img src="static/covers/barricades.jpg" alt="Barricades" class="album-cover">
                    </div>
                    <div class="music-info">
                        <h3 class="song-title" onclick="showSongDetail(3)">Barricades</h3>
                        <div class="song-meta">
                            <span class="song-artist">æ³½é‡å¼˜ä¹‹</span>
                            <span class="song-album">Pop</span>
                        </div>
                        <div class="play-control">
                            <span class="duration">3:41</span>
                            <button class="play-btn" onclick="playSong(3, 'Barricades', 'æ³½é‡å¼˜ä¹‹')">
                                æ’­æ”¾
                            </button>
                            <button class="favorite-btn" onclick="toggleFavorite(3, this)">
                                â™¡
                            </button>
                        </div>
                    </div>
                </div>
                <div class="music-card">
                    <div class="album-cover-container">
                        <img src="static/covers/lwymmd.jpg" alt="Look You What Made Me Do" class="album-cover">
                    </div>
                    <div class="music-info">
                        <h3 class="song-title" onclick="showSongDetail(4)">Look You What Made Me Do</h3>
                        <div class="song-meta">
                            <span class="song-artist">Taylor Swift</span>
                            <span class="song-album">Pop</span>
                        </div>
                        <div class="play-control">
                            <span class="duration">3:31</span>
                            <button class="play-btn" onclick="playSong(4, 'Look You What Made Me Do', 'Taylor Swift')">
                                æ’­æ”¾
                            </button>
                            <button class="favorite-btn" onclick="toggleFavorite(4, this)">
                                â™¡
                            </button>
                        </div>
                    </div>
                </div>
                <div class="music-card">
                    <div class="album-cover-container">
                        <img src="static/covers/winter_feels.jpg" alt="this is what winter feels like" class="album-cover">
                    </div>
                    <div class="music-info">
                        <h3 class="song-title" onclick="showSongDetail(5)">this is what winter feels like</h3>
                        <div class="song-meta">
                            <span class="song-artist">JVKE</span>
                            <span class="song-album">pop</span>
                        </div>
                        <div class="play-control">
                            <span class="duration">3:14</span>
                            <button class="play-btn" onclick="playSong(5, 'this is what winter feels like', 'JVKE')">
                                æ’­æ”¾
                            </button>
                            <button class="favorite-btn" onclick="toggleFavorite(5, this)">
                                â™¡
                            </button>
                        </div>
                    </div>
                </div>
                <div class="music-card">
                    <div class="album-cover-container">
                        <img src="static/covers/counting_stars.jpg" alt="Counting Stars" class="album-cover">
                    </div>
                    <div class="music-info">
                        <h3 class="song-title" onclick="showSongDetail(6)">Counting Stars</h3>
                        <div class="song-meta">
                            <span class="song-artist">One Republics</span>
                            <span class="song-album">pop</span>
                        </div>
                        <div class="play-control">
                            <span class="duration">4:17</span>
                            <button class="play-btn" onclick="playSong(6, 'Counting Stars', 'One Republics')">
                                æ’­æ”¾
                            </button>
                            <button class="favorite-btn" onclick="toggleFavorite(6, this)">
                                â™¡
                            </button>
                        </div>
                    </div>
                </div>
                <div class="music-card">
                    <div class="album-cover-container">
                        <img src="static/covers/lose_my_mind.jpg" alt="Lose My Mind" class="album-cover">
                    </div>
                    <div class="music-info">
                        <h3 class="song-title" onclick="showSongDetail(7)">Lose My Mind</h3>
                        <div class="song-meta">
                            <span class="song-artist">Don Toliver;Doja Cat</span>
                            <span class="song-album">pop</span>
                        </div>
                        <div class="play-control">
                            <span class="duration">3:29</span>
                            <button class="play-btn" onclick="playSong(7, 'Lose My Mind', 'Don Toliver;Doja Cat')">
                                æ’­æ”¾
                            </button>
                            <button class="favorite-btn" onclick="toggleFavorite(7, this)">
                                â™¡
                            </button>
                        </div>
                    </div>
                </div>
                <div class="music-card">
                    <div class="album-cover-container">
                        <img src="static/covers/shape_of_you.jpg" alt="Shape of you" class="album-cover">
                    </div>
                    <div class="music-info">
                        <h3 class="song-title" onclick="showSongDetail(8)">Shape of You</h3>
                        <div class="song-meta">
                            <span class="song-artist">Ed Sheeran</span>
                            <span class="song-album">pop</span>
                        </div>
                        <div class="play-control">
                            <span class="duration">3:53</span>
                            <button class="play-btn" onclick="playSong(8, 'Shape of You', 'Ed Sheeran')">
                                æ’­æ”¾
                            </button>
                            <button class="favorite-btn" onclick="toggleFavorite(8, this)">
                                â™¡
                            </button>
                        </div>
                    </div>
                </div>
                <div class="music-card">
                    <div class="album-cover-container">
                        <img src="static/covers/afterglow.jpg" alt="Afterglow" class="album-cover">
                    </div>
                    <div class="music-info">
                        <h3 class="song-title" onclick="showSongDetail(9)">Afterglow</h3>
                        <div class="song-meta">
                            <span class="song-artist">Taylor Swift</span>
                            <span class="song-album">pop</span>
                        </div>
                        <div class="play-control">
                            <span class="duration">3:43</span>
                            <button class="play-btn" onclick="playSong(9, 'Afterglow', 'Taylor Swift')">
                                æ’­æ”¾
                            </button>
                            <button class="favorite-btn" onclick="toggleFavorite(9, this)">
                                â™¡
                            </button>
                        </div>
                    </div>
                </div>
                <div class="music-card">
                    <div class="album-cover-container">
                        <img src="static/covers/forever.jpg" alt="Forever" class="album-cover">
                    </div>
                    <div class="music-info">
                        <h3 class="song-title" onclick="showSongDetail(10)">Forever</h3>
                        <div class="song-meta">
                            <span class="song-artist">keshi</span>
                            <span class="song-album">K-pop</span>
                        </div>
                        <div class="play-control">
                            <span class="duration">2:51</span>
                            <button class="play-btn" onclick="playSong(10, 'Forever', 'keshi')">
                                æ’­æ”¾
                            </button>
                            <button class="favorite-btn" onclick="toggleFavorite(10, this)">
                                â™¡
                            </button>
                        </div>
                    </div>
                </div>
                <div class="music-card">
                    <div class="album-cover-container">
                        <img src="static/covers/koi_o_oikakete.jpg" alt="ã‚³ã‚¦ã‚’è¿½ã„ã‹ã‘ã¦" class="album-cover">
                    </div>
                    <div class="music-info">
                        <h3 class="song-title" onclick="showSongDetail(11)">ã‚³ã‚¦ã‚’è¿½ã„ã‹ã‘ã¦</h3>
                        <div class="song-meta">
                            <span class="song-artist">å‚æœ¬ç§€ä¸€</span>
                            <span class="song-album">çº¯éŸ³ä¹</span>
                        </div>
                        <div class="play-control">
                            <span class="duration">1:55</span>
                            <button class="play-btn" onclick="playSong(11, 'ã‚³ã‚¦ã‚’è¿½ã„ã‹ã‘ã¦', 'å‚æœ¬ç§€ä¸€')">
                                æ’­æ”¾
                            </button>
                            <button class="favorite-btn" onclick="toggleFavorite(11, this)">
                                â™¡
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="load-more-trigger">
                <div class="loading-spinner"></div> åŠ è½½æ›´å¤š...
            </div>
        </div>

        <!-- æ”¶è—é¢æ¿ -->
        <div id="favorites-panel" class="management-panel">
            <div class="panel-header">
                <h2 class="panel-title">æˆ‘çš„æ”¶è—</h2>
                <p>æ‚¨æ”¶è—çš„éŸ³ä¹ä½œå“</p>
            </div>
            <div class="music-grid" id="favorites-grid">
                <!-- æ”¶è—çš„éŸ³ä¹å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
            </div>
            <div id="no-favorites" style="text-align: center; padding: 40px; display: none;">
                <p>æ‚¨è¿˜æ²¡æœ‰æ”¶è—ä»»ä½•éŸ³ä¹</p>
                <button class="play-btn" onclick="showPanel('recommendation-panel')">å»å‘ç°éŸ³ä¹</button>
            </div>
        </div>

        <!-- éŸ³ä¹ç®¡ç†é¢æ¿ -->
        <div id="music-panel" class="management-panel">
            <div class="panel-header">
                <h2 class="panel-title">éŸ³ä¹ç®¡ç†</h2>
                <p>ç®¡ç†éŸ³ä¹åº“ä¸­çš„æ‰€æœ‰éŸ³ä¹</p>
            </div>
            <button class="add-btn" onclick="openMusicModal()">æ·»åŠ éŸ³ä¹</button>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>æ­Œæ›²åç§°</th>
                        <th>è‰ºæœ¯å®¶</th>
                        <th>ä¸“è¾‘</th>
                        <th>æµæ´¾</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="musicTableBody">
                    <!-- éŸ³ä¹æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                </tbody>
            </table>
        </div>

        <!-- åˆ†ç±»æ ‡ç­¾ç®¡ç†é¢æ¿ -->
        <div id="category-tag-panel" class="management-panel">
            <div class="panel-header">
                <h2 class="panel-title">åˆ†ç±»æ ‡ç­¾ç®¡ç†</h2>
            </div>
            <button class="add-btn" onclick="openCategoryTagModal()">æ·»åŠ åˆ†ç±»/æ ‡ç­¾</button>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>åç§°</th>
                        <th>ç±»å‹</th>
                        <th>æè¿°</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="categoryTagTableBody">
                    <!-- åˆ†ç±»æ ‡ç­¾æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                </tbody>
            </table>
        </div>

        <!-- ç”¨æˆ·ç®¡ç†é¢æ¿ -->
        <div id="user-panel" class="management-panel">
            <div class="panel-header">
                <h2 class="panel-title">ç”¨æˆ·ç®¡ç†</h2>
            </div>
            <button class="add-btn" onclick="openUserModal()">æ·»åŠ ç”¨æˆ·</button>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>ç”¨æˆ·å</th>
                        <th>é‚®ç®±</th>
                        <th>è§’è‰²</th>
                        <th>æ³¨å†Œæ—¶é—´</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="userTableBody">
                    <!-- ç”¨æˆ·æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                </tbody>
            </table>
        </div>

        <!-- è¯„è®ºç®¡ç†é¢æ¿ -->
        <div id="comment-panel" class="management-panel">
            <div class="panel-header">
                <h2 class="panel-title">è¯„è®ºç®¡ç†</h2>
            </div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>æ­Œæ›²</th>
                        <th>ç”¨æˆ·</th>
                        <th>è¯„è®ºå†…å®¹</th>
                        <th>æ—¶é—´</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="commentTableBody">
                    <!-- è¯„è®ºæ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                </tbody>
            </table>
        </div>

        <!-- è¿è¥ç®¡ç†é¢æ¿ -->
        <div id="operation-panel" class="management-panel">
            <div class="panel-header">
                <h2 class="panel-title">è¿è¥ç®¡ç†</h2>
            </div>
            <div class="operation-content">
                <p>è¿è¥æ•°æ®ç»Ÿè®¡å’Œåˆ†æå°†æ˜¾ç¤ºåœ¨è¿™é‡Œã€‚</p>
            </div>
        </div>

        <!-- æ—¥å¿—ç®¡ç†é¢æ¿ -->
        <div id="log-panel" class="management-panel">
            <div class="panel-header">
                <h2 class="panel-title">æ—¥å¿—ç®¡ç†</h2>
            </div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>æ—¶é—´</th>
                        <th>ç”¨æˆ·</th>
                        <th>æ“ä½œ</th>
                        <th>è¯¦æƒ…</th>
                    </tr>
                </thead>
                <tbody id="logTableBody">
                    <!-- æ—¥å¿—æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                </tbody>
            </table>
        </div>

        <!-- ç³»ç»Ÿä¿¡æ¯é¢æ¿ -->
        <div id="system-panel" class="management-panel">
            <div class="panel-header">
                <h2 class="panel-title">ç³»ç»Ÿä¿¡æ¯</h2>
            </div>
            <div class="system-info">
                <p>ç³»ç»Ÿç‰ˆæœ¬: 1.0.0</p>
                <p>æœåŠ¡å™¨çŠ¶æ€: è¿è¡Œä¸­</p>
                <p>æ•°æ®åº“çŠ¶æ€: æ­£å¸¸</p>
                <p>æœ€åå¤‡ä»½: 2023-05-15</p>
            </div>
        </div>
    </main>

    <script>
        // å½“å‰ç™»å½•ç”¨æˆ·
        let currentUser = null;
        // å½“å‰æ’­æ”¾æ­Œæ›²
        let currentSong = null;
        // æ¨¡æ‹Ÿæ­Œæ›²æ•°æ®åº“
        const songsDatabase = {
            1: {
                id: 1,
                title: "Our Summer",
                artist: "TXT",
                album: "The Dream Chapter: MAGIC",
                cover: "static/covers/our_summer.jpg",
                audio: "static/audio/song1.mp3",
                duration: "3:30",
                genre: "K-pop",
                releaseDate: "2019-10-21",
                lyrics: `[Verse 1]
It's you and me in this moment
Don't ever let it fade away
The way you look under the moonlight
I wanna stay here every day`,
                relatedSongs: [2, 5, 10],
                isFavorite: false,
                categories: ["K-pop", "æµè¡Œ"],
                tags: ["å¤æ—¥", "é’æ˜¥"]
            },
            2: {
                id: 2,
                title: "Run Free",
                artist: "Deep Chills",
                album: "Single",
                cover: "static/covers/run_free.jpg",
                audio: "static/audio/song2.mp3",
                duration: "2:50",
                genre: "Pop",
                releaseDate: "2020-05-15",
                lyrics: `[Verse 1]
Running through the night
Feel the wind in your hair
Nothing can stop us now
We're free as the air`,
                relatedSongs: [1, 3],
                isFavorite: false,
                categories: ["ç”µå­", "æµè¡Œ"],
                tags: ["è‡ªç”±", "å¥”è·‘"]
            },
            3: {
                id: 3,
                title: "Barricades",
                artist: "æ³½é‡å¼˜ä¹‹",
                album: "Attack on Titan OST",
                cover: "static/covers/barricades.jpg",
                audio: "static/audio/song3.mp3",
                duration: "3:41",
                genre: "Anime",
                releaseDate: "2017-06-07",
                lyrics: `[Verse 1]
Standing in the ruins
Of what we used to be
The walls have all come down
But we're still not free`,
                relatedSongs: [2, 4],
                isFavorite: false,
                categories: ["åŠ¨æ¼«", "åŸå£°"],
                tags: ["æˆ˜æ–—", "å²è¯—"]
            },
            4: {
                id: 4,
                title: "Look You What Made Me Do",
                artist: "Taylor Swift",
                album: "Reputation",
                cover: "static/covers/lwymmd.jpg",
                audio: "static/audio/song4.mp3",
                duration: "3:31",
                genre: "Pop",
                releaseDate: "2017-08-25",
                lyrics: `[Verse 1]
I don't like your little games
Don't like your tilted stage
The role you made me play
Of the fool, no, I don't like you`,
                relatedSongs: [1, 5],
                isFavorite: false,
                categories: ["æµè¡Œ"],
                tags: ["å¤ä»‡", "æµè¡Œ"]
            },
            5: {
                id: 5,
                title: "this is what winter feels like",
                artist: "JVKE",
                album: "this is what winter feels like",
                cover: "static/covers/winter_feels.jpg",
                audio: "static/audio/song5.mp3",
                duration: "3:14",
                genre: "Pop",
                releaseDate: "2022-12-09",
                lyrics: `[Verse 1]
Snowflakes falling down
Like confetti on the ground
The air is getting colder now
But I don't mind it with you around`,
                relatedSongs: [4, 6],
                isFavorite: false,
                categories: ["æµè¡Œ"],
                tags: ["å†¬å­£", "æµªæ¼«"]
            },
            6: {
                id: 6,
                title: "Counting Stars",
                artist: "One Republic",
                album: "Native",
                cover: "static/covers/counting_stars.jpg",
                audio: "static/audio/song6.mp3",
                duration: "4:17",
                genre: "Pop",
                releaseDate: "2013-06-14",
                lyrics: `[Verse 1]
Lately, I've been, I've been losing sleep
Dreaming about the things that we could be
But baby, I've been, I've been praying hard
Said no more counting dollars
We'll be counting stars`,
                relatedSongs: [5, 7],
                isFavorite: false,
                categories: ["æµè¡Œ"],
                tags: ["åŠ±å¿—", "æ¢¦æƒ³"]
            },
            7: {
                id: 7,
                title: "Lose My Mind",
                artist: "Don Toliver;Doja Cat",
                album: "Life of a DON",
                cover: "static/covers/lose_my_mind.jpg",
                audio: "static/audio/song7.mp3",
                duration: "3:29",
                genre: "Pop",
                releaseDate: "2021-10-08",
                lyrics: `[Verse 1]
I lose my mind when I'm with you
I lose my mind when I'm with you
I lose my mind when I'm with you
I lose my mind when I'm with you`,
                relatedSongs: [6, 8],
                isFavorite: false,
                categories: ["æµè¡Œ"],
                tags: ["çˆ±æƒ…", "ç–¯ç‹‚"]
            },
            8: {
                id: 8,
                title: "Shape of You",
                artist: "Ed Sheeran",
                album: "Ã·",
                cover: "static/covers/shape_of_you.jpg",
                audio: "static/audio/song8.mp3",
                duration: "3:53",
                genre: "Pop",
                releaseDate: "2017-01-06",
                lyrics: `[Verse 1]
The club isn't the best place to find a lover
So the bar is where I go
Me and my friends at the table doing shots
Drinking fast and then we talk slow`,
                relatedSongs: [7, 9],
                isFavorite: false,
                categories: ["æµè¡Œ"],
                tags: ["çˆ±æƒ…", "èˆæ›²"]
            },
            9: {
                id: 9,
                title: "Afterglow",
                artist: "Taylor Swift",
                album: "Lover",
                cover: "static/covers/afterglow.jpg",
                audio: "static/audio/song9.mp3",
                duration: "3:43",
                genre: "Pop",
                releaseDate: "2019-12-15",
                lyrics: `[Verse 1]
Fighting with a true love is boxing with no gloves
Chemistry 'til it blows up, 'til there's no us
Why'd I have to break what I love so much?
It's on your face, and I'm to blame, I need to say`,
                relatedSongs: [8, 10],
                isFavorite: false,
                categories: ["æµè¡Œ"],
                tags: ["çˆ±æƒ…", "å’Œè§£"]
            },
            10: {
                id: 10,
                title: "Forever",
                artist: "keshi",
                album: "always",
                cover: "static/covers/forever.jpg",
                audio: "static/audio/song10.mp3",
                duration: "2:51",
                genre: "K-pop",
                releaseDate: "2020-12-11",
                lyrics: `[Verse 1]
I don't wanna wait another day
I don't wanna wait another night
I don't wanna wait another life
To be with you`,
                relatedSongs: [9, 1],
                isFavorite: false,
                categories: ["K-pop"],
                tags: ["æ°¸æ’", "çˆ±æƒ…"]
            },
            11: {
                id: 11,
                title: "ã‚³ã‚¦ã‚’è¿½ã„ã‹ã‘ã¦",
                artist: "å‚æœ¬ç§€ä¸€",
                album: "ç´”éŸ³æ¥½",
                cover: "static/covers/koi_o_oikakete.jpg",
                audio: "static/audio/song11.mp3",
                duration: "1:55",
                genre: "çº¯éŸ³ä¹",
                releaseDate: "2020-05-20",
                lyrics: "",
                relatedSongs: [10, 1],
                isFavorite: false,
                categories: ["çº¯éŸ³ä¹"],
                tags: ["æ²»æ„ˆ", "å®‰é™"]
            }
        };

        // æ¨¡æ‹Ÿåˆ†ç±»æ ‡ç­¾æ•°æ®åº“
        const categoryTagDatabase = {
            1: { id: 1, name: "K-pop", type: "category", description: "éŸ©å›½æµè¡ŒéŸ³ä¹" },
            2: { id: 2, name: "æµè¡Œ", type: "category", description: "æµè¡ŒéŸ³ä¹" },
            3: { id: 3, name: "ç”µå­", type: "category", description: "ç”µå­éŸ³ä¹" },
            4: { id: 4, name: "åŠ¨æ¼«", type: "category", description: "åŠ¨æ¼«éŸ³ä¹" },
            5: { id: 5, name: "åŸå£°", type: "category", description: "å½±è§†åŸå£°éŸ³ä¹" },
            6: { id: 6, name: "çº¯éŸ³ä¹", type: "category", description: "çº¯éŸ³ä¹ä½œå“" },
            7: { id: 7, name: "å¤æ—¥", type: "tag", description: "é€‚åˆå¤å¤©çš„éŸ³ä¹" },
            8: { id: 8, name: "é’æ˜¥", type: "tag", description: "é’æ˜¥ä¸»é¢˜éŸ³ä¹" },
            9: { id: 9, name: "è‡ªç”±", type: "tag", description: "è‡ªç”±ä¸»é¢˜éŸ³ä¹" },
            10: { id: 10, name: "å¥”è·‘", type: "tag", description: "è¿åŠ¨è·‘æ­¥éŸ³ä¹" },
            11: { id: 11, name: "æˆ˜æ–—", type: "tag", description: "æˆ˜æ–—ä¸»é¢˜éŸ³ä¹" },
            12: { id: 12, name: "å²è¯—", type: "tag", description: "å²è¯—é£æ ¼éŸ³ä¹" },
            13: { id: 13, name: "å¤ä»‡", type: "tag", description: "å¤ä»‡ä¸»é¢˜éŸ³ä¹" },
            14: { id: 14, name: "å†¬å­£", type: "tag", description: "å†¬å­£ä¸»é¢˜éŸ³ä¹" },
            15: { id: 15, name: "æµªæ¼«", type: "tag", description: "æµªæ¼«ä¸»é¢˜éŸ³ä¹" },
            16: { id: 16, name: "åŠ±å¿—", type: "tag", description: "åŠ±å¿—ä¸»é¢˜éŸ³ä¹" },
            17: { id: 17, name: "æ¢¦æƒ³", type: "tag", description: "æ¢¦æƒ³ä¸»é¢˜éŸ³ä¹" },
            18: { id: 18, name: "çˆ±æƒ…", type: "tag", description: "çˆ±æƒ…ä¸»é¢˜éŸ³ä¹" },
            19: { id: 19, name: "ç–¯ç‹‚", type: "tag", description: "ç–¯ç‹‚ä¸»é¢˜éŸ³ä¹" },
            20: { id: 20, name: "èˆæ›²", type: "tag", description: "é€‚åˆè·³èˆçš„éŸ³ä¹" },
            21: { id: 21, name: "å’Œè§£", type: "tag", description: "å’Œè§£ä¸»é¢˜éŸ³ä¹" },
            22: { id: 22, name: "æ°¸æ’", type: "tag", description: "æ°¸æ’ä¸»é¢˜éŸ³ä¹" },
            23: { id: 23, name: "æ²»æ„ˆ", type: "tag", description: "æ²»æ„ˆç³»éŸ³ä¹" },
            24: { id: 24, name: "å®‰é™", type: "tag", description: "å®‰é™èˆ’ç¼“çš„éŸ³ä¹" }
        };

        // æ¨¡æ‹Ÿè¯„è®ºæ•°æ®åº“
        const commentsDatabase = {
            1: { id: 1, songId: 1, userId: 101, username: "éŸ³ä¹çˆ±å¥½è€…", content: "è¿™é¦–æ­Œè®©æˆ‘æƒ³èµ·äº†å¤å¤©çš„ç¾å¥½æ—¶å…‰ï¼", time: "2023-05-10 14:30:22" },
            2: { id: 2, songId: 1, userId: 102, username: "K-popç²‰ä¸", content: "TXTçš„æ–°æ­Œå¤ªå¥½å¬äº†ï¼Œå¾ªç¯æ’­æ”¾ä¸­ï¼", time: "2023-05-11 09:15:45" },
            3: { id: 3, songId: 2, userId: 103, username: "è·‘æ­¥è¾¾äºº", content: "è·‘æ­¥æ—¶å¬è¿™é¦–æ­Œç‰¹åˆ«å¸¦åŠ²ï¼", time: "2023-05-12 18:22:10" },
            4: { id: 4, songId: 3, userId: 104, username: "åŠ¨æ¼«è¿·", content: "æ³½é‡å¼˜ä¹‹çš„éŸ³ä¹æ€»æ˜¯è¿™ä¹ˆéœ‡æ’¼ï¼", time: "2023-05-13 21:05:33" },
            5: { id: 5, songId: 4, userId: 105, username: "Swiftie", content: "Taylorçš„è¿™é¦–æ­Œå¤ªæœ‰åŠ›é‡äº†ï¼", time: "2023-05-14 10:30:15" },
            6: { id: 6, songId: 5, userId: 106, username: "å†¬å­£æ‹äºº", content: "å†¬å¤©çš„æ„Ÿè§‰å®Œç¾ä½“ç°åœ¨è¿™é¦–æ­Œé‡Œï¼", time: "2023-05-15 15:45:22" }
        };

        // æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®åº“
        const usersDatabase = {
            1: { id: 1, username: "admin", email: "admin@example.com", role: "admin", password: "123456", registerTime: "2023-01-01" },
            101: { id: 101, username: "éŸ³ä¹çˆ±å¥½è€…", email: "musiclover@example.com", role: "user", password: "music123", registerTime: "2023-01-15" },
            102: { id: 102, username: "K-popç²‰ä¸", email: "kpopfan@example.com", role: "user", password: "kpop123", registerTime: "2023-02-20" },
            103: { id: 103, username: "è·‘æ­¥è¾¾äºº", email: "runner@example.com", role: "user", password: "run123", registerTime: "2023-03-05" },
            104: { id: 104, username: "åŠ¨æ¼«è¿·", email: "animefan@example.com", role: "editor", password: "anime123", registerTime: "2023-04-10" },
            105: { id: 105, username: "Swiftie", email: "swiftie@example.com", role: "user", password: "swift123", registerTime: "2023-04-15" },
            106: { id: 106, username: "å†¬å­£æ‹äºº", email: "winterlover@example.com", role: "user", password: "winter123", registerTime: "2023-04-20" }
        };

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ç¡®ä¿æ¨èé¢æ¿é»˜è®¤æ˜¾ç¤º
            document.getElementById('recommendation-panel').style.display = 'block';

            // éšè—æ‰€æœ‰ç®¡ç†å‘˜åŠŸèƒ½
            document.querySelectorAll('.admin-only').forEach(el => {
                el.style.display = 'none';
            });

            // æ£€æŸ¥ç™»å½•çŠ¶æ€
            checkLoginStatus();

            // åˆå§‹åŒ–æ— é™æ»šåŠ¨
            initInfiniteScroll();
        });

        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        async function checkLoginStatus() {
            const token = localStorage.getItem('authToken');
            if (token) {
                const userId = parseInt(token.split('-')[1]);
                currentUser = usersDatabase[userId];
                if (currentUser) {
                    updateUIAfterLogin();
                    loadFavorites(); // åŠ è½½æ”¶è—åˆ—è¡¨
                }
            }
        }

        // åˆå§‹åŒ–æ— é™æ»šåŠ¨
        function initInfiniteScroll() {
            const observer = new IntersectionObserver((entries) => {
                if (entries[0].isIntersecting) {
                    loadMoreSongs();
                }
            }, { threshold: 0.1 });

            const trigger = document.querySelector('.load-more-trigger');
            if (trigger) {
                observer.observe(trigger);
            }
        }

        // åŠ è½½æ”¶è—æ­Œæ›²
        function loadFavorites() {
            const favoritesGrid = document.getElementById('favorites-grid');
            const noFavorites = document.getElementById('no-favorites');

            favoritesGrid.innerHTML = '';

            const favoriteSongs = Object.values(songsDatabase).filter(song => song.isFavorite);

            if (favoriteSongs.length === 0) {
                noFavorites.style.display = 'block';
                return;
            }

            noFavorites.style.display = 'none';

            favoriteSongs.forEach(song => {
                const card = document.createElement('div');
                card.className = 'music-card';
                card.innerHTML = `
                    <div class="album-cover-container">
                        <img src="${song.cover}" alt="${song.title}" class="album-cover">
                    </div>
                    <div class="music-info">
                        <h3 class="song-title" onclick="showSongDetail(${song.id})">${song.title}</h3>
                        <div class="song-meta">
                            <span class="song-artist">${song.artist}</span>
                            <span class="song-album">${song.album}</span>
                        </div>
                        <div class="play-control">
                            <span class="duration">${song.duration}</span>
                            <button class="play-btn" onclick="playSong(${song.id}, '${song.title}', '${song.artist}')">
                                æ’­æ”¾
                            </button>
                            <button class="favorite-btn favorited" onclick="toggleFavorite(${song.id}, this)">
                                â™¥
                            </button>
                        </div>
                    </div>
                `;
                favoritesGrid.appendChild(card);
            });
        }

        // åŠ è½½æ›´å¤šæ­Œæ›²
        function loadMoreSongs() {
            const trigger = document.querySelector('.load-more-trigger');
            trigger.innerHTML = '<div class="loading-spinner"></div> åŠ è½½ä¸­...';

            // æ¨¡æ‹ŸåŠ è½½å»¶è¿Ÿ
            setTimeout(() => {
                trigger.innerHTML = '<div class="loading-spinner"></div> åŠ è½½æ›´å¤š...';
            }, 1000);
        }

        // æ˜¾ç¤ºæ­Œæ›²è¯¦æƒ…
        function showSongDetail(songId) {
            const song = songsDatabase[songId];
            if (!song) return;

            currentSong = song;

            // è·å–è¿™é¦–æ­Œçš„è¯„è®º
            const songComments = Object.values(commentsDatabase).filter(comment => comment.songId === songId);

            // åˆ›å»ºè¯„è®ºHTML
            let commentsHTML = '';
            songComments.forEach(comment => {
                commentsHTML += `
                    <li class="comment-item">
                        <div class="comment-header">
                            <span class="comment-user">${comment.username}</span>
                            <span class="comment-time">${comment.time}</span>
                        </div>
                        <div class="comment-content">${comment.content}</div>
                        ${currentUser && (currentUser.role === 'admin' || currentUser.id === comment.userId) ? `<div class="comment-actions">
                            <span class="comment-action" onclick="editComment(${comment.id})">ç¼–è¾‘</span>
                            <span class="comment-action" onclick="deleteComment(${comment.id})">åˆ é™¤</span>
                        </div>` : ''}
                    </li>
                `;
            });

            // åˆ›å»ºè¯¦æƒ…é¢æ¿HTML
            const detailHTML = `
                <div class="back-to-list" onclick="backToList()">&larr; è¿”å›åˆ—è¡¨</div>
                <div class="song-detail-header">
                    <img class="song-detail-cover" src="${song.cover}" alt="ä¸“è¾‘å°é¢">
                    <div class="song-detail-info">
                        <h1 class="song-detail-title">${song.title}</h1>
                        <h2 class="song-detail-artist">${song.artist}</h2>
                        <div class="song-detail-meta">
                            <div class="song-detail-meta-item">
                                <span class="song-detail-meta-label">ä¸“è¾‘:</span>
                                <span class="song-detail-meta-value">${song.album}</span>
                            </div>
                            <div class="song-detail-meta-item">
                                <span class="song-detail-meta-label">æ—¶é•¿:</span>
                                <span class="song-detail-meta-value">${song.duration}</span>
                            </div>
                            <div class="song-detail-meta-item">
                                <span class="song-detail-meta-label">æµæ´¾:</span>
                                <span class="song-detail-meta-value">${song.genre}</span>
                            </div>
                            <div class="song-detail-meta-item">
                                <span class="song-detail-meta-label">åˆ†ç±»:</span>
                                <span class="song-detail-meta-value">${song.categories.join(', ')}</span>
                            </div>
                            <div class="song-detail-meta-item">
                                <span class="song-detail-meta-label">æ ‡ç­¾:</span>
                                <span class="song-detail-meta-value">${song.tags.join(', ')}</span>
                            </div>
                        </div>
                        <div class="song-detail-actions">
                            <button class="play-btn" onclick="playSong(${song.id}, '${song.title}', '${song.artist}')">æ’­æ”¾</button>
                            <button class="favorite-btn ${song.isFavorite ? 'favorited' : ''}" onclick="toggleFavorite(${song.id}, this)">
                                ${song.isFavorite ? 'â™¥' : 'â™¡'}
                            </button>
                        </div>
                    </div>
                </div>
                <div class="song-detail-content">
                    <div class="song-detail-lyrics">
                        ${song.lyrics}
                    </div>
                </div>
                <div class="comments-section">
                    <h3 class="comments-title">è¯„è®º (${songComments.length})</h3>
                    ${currentUser ? `
                    <div class="comment-form">
                        <textarea class="comment-input" id="newComment" placeholder="å†™ä¸‹ä½ çš„è¯„è®º..."></textarea>
                        <button class="comment-submit" onclick="submitComment(${songId})">å‘è¡¨è¯„è®º</button>
                    </div>
                    ` : ''}
                    <ul class="comment-list">
                        ${commentsHTML}
                    </ul>
                </div>
            `;

            // æ›´æ–°æ¨èé¢æ¿æ˜¾ç¤ºè¯¦æƒ…
            const panel = document.getElementById('recommendation-panel');
            panel.innerHTML = detailHTML;
        }

        // æäº¤è¯„è®º
        function submitComment(songId) {
            if (!currentUser) {
                alert('è¯·å…ˆç™»å½•');
                return;
            }

            const commentContent = document.getElementById('newComment').value.trim();
            if (!commentContent) {
                alert('è¯„è®ºå†…å®¹ä¸èƒ½ä¸ºç©º');
                return;
            }

            // åˆ›å»ºæ–°è¯„è®ºID
            const newCommentId = Math.max(...Object.keys(commentsDatabase).map(Number)) + 1;

            // è·å–å½“å‰æ—¶é—´
            const now = new Date();
            const formattedTime = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;

            // æ·»åŠ æ–°è¯„è®ºåˆ°æ•°æ®åº“
            commentsDatabase[newCommentId] = {
                id: newCommentId,
                songId: songId,
                userId: currentUser.id,
                username: currentUser.username,
                content: commentContent,
                time: formattedTime
            };

            // é‡æ–°åŠ è½½æ­Œæ›²è¯¦æƒ…ä»¥æ˜¾ç¤ºæ–°è¯„è®º
            showSongDetail(songId);

            // å¦‚æœè¯„è®ºç®¡ç†é¢æ¿æ˜¯æ‰“å¼€çš„ï¼Œä¹Ÿåˆ·æ–°å®ƒ
            if (document.getElementById('comment-panel').style.display === 'block') {
                loadCommentManagementData();
            }

            alert('è¯„è®ºå‘è¡¨æˆåŠŸï¼');
        }

        // ç¼–è¾‘è¯„è®º
        function editComment(commentId) {
            const comment = commentsDatabase[commentId];
            if (!comment) return;

            document.getElementById('commentId').value = commentId;
            document.getElementById('commentSongId').value = comment.songId;
            document.getElementById('commentContent').value = comment.content;
            document.getElementById('commentModalTitle').textContent = 'ç¼–è¾‘è¯„è®º';

            document.getElementById('commentModal').style.display = 'block';
        }

        // ä¿å­˜è¯„è®ºç¼–è¾‘
        function saveComment() {
            const commentId = parseInt(document.getElementById('commentId').value);
            const commentContent = document.getElementById('commentContent').value.trim();

            if (!commentContent) {
                alert('è¯„è®ºå†…å®¹ä¸èƒ½ä¸ºç©º');
                return;
            }

            // æ›´æ–°è¯„è®ºå†…å®¹
            commentsDatabase[commentId].content = commentContent;

            // å…³é—­æ¨¡æ€æ¡†
            closeCommentModal();

            // é‡æ–°åŠ è½½æ­Œæ›²è¯¦æƒ…æˆ–è¯„è®ºç®¡ç†é¢æ¿
            const songId = parseInt(document.getElementById('commentSongId').value);
            if (document.getElementById('recommendation-panel').style.display === 'block') {
                showSongDetail(songId);
            } else {
                loadCommentManagementData();
            }

            alert('è¯„è®ºæ›´æ–°æˆåŠŸï¼');
        }

        // åˆ é™¤è¯„è®º
        function deleteComment(commentId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è¯„è®ºå—ï¼Ÿ')) return;

            const songId = commentsDatabase[commentId].songId;
            delete commentsDatabase[commentId];

            // é‡æ–°åŠ è½½æ­Œæ›²è¯¦æƒ…æˆ–è¯„è®ºç®¡ç†é¢æ¿
            if (document.getElementById('recommendation-panel').style.display === 'block') {
                showSongDetail(songId);
            } else {
                loadCommentManagementData();
            }

            alert('è¯„è®ºå·²åˆ é™¤');
        }

        // å…³é—­è¯„è®ºæ¨¡æ€æ¡†
        function closeCommentModal() {
            document.getElementById('commentModal').style.display = 'none';
        }

        // è¿”å›åˆ—è¡¨
        function backToList() {
            const panel = document.getElementById('recommendation-panel');
            panel.innerHTML = `
                <div class="recommendation-header">
                    <h1 class="recommendation-title">ä»Šæ—¥éŸ³ä¹æ¨è</h1>
                    <p class="recommendation-subtitle">å‘ç°æœ€æ–°æœ€çƒ­çš„éŸ³ä¹ä½œå“</p>
                </div>
                <div class="music-grid">
                    <!-- éŸ³ä¹å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                </div>
                <div class="load-more-trigger">
                    <div class="loading-spinner"></div> åŠ è½½æ›´å¤š...
                </div>
            `;

            // é‡æ–°åŠ è½½æ­Œæ›²
            loadSongs();
            initInfiniteScroll();
        }

        // æ’­æ”¾æ­Œæ›²
        function playSong(songId, title, artist) {
            const player = document.getElementById('globalPlayer');
            const songTitle = document.getElementById('currentSongTitle');
            const songArtist = document.getElementById('currentSongArtist');
            const audioPlayer = document.getElementById('audioPlayer');

            songTitle.textContent = title;
            songArtist.textContent = artist;
            player.style.display = 'block';

            // ä½¿ç”¨æ¨¡æ‹ŸéŸ³é¢‘è·¯å¾„
            audioPlayer.src = songsDatabase[songId].audio;
            audioPlayer.play();
        }

        // å…³é—­æ’­æ”¾å™¨
        function closePlayer() {
            const player = document.getElementById('globalPlayer');
            const audioPlayer = document.getElementById('audioPlayer');

            audioPlayer.pause();
            player.style.display = 'none';
        }

        // åˆ‡æ¢æ”¶è—çŠ¶æ€
        function toggleFavorite(songId, element) {
            if (!currentUser) {
                alert('è¯·å…ˆç™»å½•');
                return;
            }

            const song = songsDatabase[songId];
            song.isFavorite = !song.isFavorite;

            if (song.isFavorite) {
                element.innerHTML = 'â™¥';
                element.classList.add('favorited');
            } else {
                element.innerHTML = 'â™¡';
                element.classList.remove('favorited');
            }

            // æ›´æ–°æ”¶è—åˆ—è¡¨
            loadFavorites();
        }

        // æ‰“å¼€è®¤è¯æ¨¡æ€æ¡†
        function openAuthModal(type = 'login') {
            const modal = document.getElementById('authModal');
            const modalTitle = document.getElementById('modalTitle');
            const confirmPasswordGroup = document.getElementById('confirmPasswordGroup');
            const authSubmitBtn = document.getElementById('authSubmitBtn');
            const toggleAuthFormBtn = document.getElementById('toggleAuthFormBtn');
            const toggleAuthFormText = document.getElementById('toggleAuthFormText');

            if (type === 'register') {
                modalTitle.textContent = 'ç”¨æˆ·æ³¨å†Œ';
                confirmPasswordGroup.style.display = 'block';
                authSubmitBtn.textContent = 'æ³¨å†Œ';
                toggleAuthFormText.textContent = 'å·²æœ‰è´¦å·ï¼Ÿ';
                toggleAuthFormBtn.textContent = 'ç«‹å³ç™»å½•';
            } else {
                modalTitle.textContent = 'ç”¨æˆ·ç™»å½•';
                confirmPasswordGroup.style.display = 'none';
                authSubmitBtn.textContent = 'ç™»å½•';
                toggleAuthFormText.textContent = 'è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ';
                toggleAuthFormBtn.textContent = 'ç«‹å³æ³¨å†Œ';
            }

            // æ¸…ç©ºè¡¨å•
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('confirmPassword').value = '';

            modal.style.display = 'block';
        }

        // åˆ‡æ¢ç™»å½•/æ³¨å†Œè¡¨å•
        function toggleAuthForm() {
            const modalTitle = document.getElementById('modalTitle');
            const confirmPasswordGroup = document.getElementById('confirmPasswordGroup');
            const authSubmitBtn = document.getElementById('authSubmitBtn');
            const toggleAuthFormBtn = document.getElementById('toggleAuthFormBtn');
            const toggleAuthFormText = document.getElementById('toggleAuthFormText');

            if (modalTitle.textContent === 'ç”¨æˆ·ç™»å½•') {
                // åˆ‡æ¢åˆ°æ³¨å†Œ
                modalTitle.textContent = 'ç”¨æˆ·æ³¨å†Œ';
                confirmPasswordGroup.style.display = 'block';
                authSubmitBtn.textContent = 'æ³¨å†Œ';
                toggleAuthFormText.textContent = 'å·²æœ‰è´¦å·ï¼Ÿ';
                toggleAuthFormBtn.textContent = 'ç«‹å³ç™»å½•';
            } else {
                // åˆ‡æ¢åˆ°ç™»å½•
                modalTitle.textContent = 'ç”¨æˆ·ç™»å½•';
                confirmPasswordGroup.style.display = 'none';
                authSubmitBtn.textContent = 'ç™»å½•';
                toggleAuthFormText.textContent = 'è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ';
                toggleAuthFormBtn.textContent = 'ç«‹å³æ³¨å†Œ';
            }
        }

        // æäº¤è®¤è¯è¡¨å•
        function submitAuthForm() {
            const modalTitle = document.getElementById('modalTitle');
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            const confirmPassword = document.getElementById('confirmPassword').value.trim();

            if (!username || !password) {
                alert('ç”¨æˆ·åå’Œå¯†ç ä¸èƒ½ä¸ºç©º');
                return;
            }

            if (modalTitle.textContent === 'ç”¨æˆ·æ³¨å†Œ') {
                // æ³¨å†Œé€»è¾‘
                if (password !== confirmPassword) {
                    alert('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´');
                    return;
                }

                // æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨
                const existingUser = Object.values(usersDatabase).find(user => user.username === username);
                if (existingUser) {
                    alert('ç”¨æˆ·åå·²å­˜åœ¨');
                    return;
                }

                // åˆ›å»ºæ–°ç”¨æˆ·ID
                const newUserId = Math.max(...Object.keys(usersDatabase).map(Number)) + 1;

                // è·å–å½“å‰æ—¶é—´
                const now = new Date();
                const formattedTime = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;

                // æ·»åŠ æ–°ç”¨æˆ·åˆ°æ•°æ®åº“
                usersDatabase[newUserId] = {
                    id: newUserId,
                    username,
                    email: `${username}@example.com`, // æ¨¡æ‹Ÿé‚®ç®±
                    role: 'user',
                    password, // å®é™…åº”ç”¨ä¸­åº”è¯¥åŠ å¯†
                    registerTime: formattedTime
                };

                // æ¨¡æ‹Ÿtoken
                localStorage.setItem('authToken', `user-${newUserId}`);

                // è®¾ç½®ä¸ºå½“å‰ç”¨æˆ·
                currentUser = usersDatabase[newUserId];

                updateUIAfterLogin();
                closeAuthModal();
                alert('æ³¨å†ŒæˆåŠŸï¼');
            } else {
                // ç™»å½•é€»è¾‘
                const user = Object.values(usersDatabase).find(u => u.username === username && u.password === password);
                if (!user) {
                    alert('ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯');
                    return;
                }

                // æ¨¡æ‹Ÿtoken
                localStorage.setItem('authToken', `user-${user.id}`);

                // è®¾ç½®ä¸ºå½“å‰ç”¨æˆ·
                currentUser = user;

                updateUIAfterLogin();
                loadFavorites(); // åŠ è½½æ”¶è—åˆ—è¡¨
                closeAuthModal();
                alert('ç™»å½•æˆåŠŸï¼');
            }
        }

        // å…³é—­è®¤è¯æ¨¡æ€æ¡†
        function closeAuthModal() {
            document.getElementById('authModal').style.display = 'none';
        }

        // ç™»å‡ºåŠŸèƒ½
        function logout() {
            currentUser = null;
            localStorage.removeItem('authToken');
            updateUIAfterLogout();
            alert('å·²é€€å‡ºç™»å½•');
        }

        // ç™»å½•åæ›´æ–°UI
        function updateUIAfterLogin() {
            if (currentUser) {
                document.getElementById('userInfo').style.display = 'flex';
                document.getElementById('guestInfo').style.display = 'none';
                document.getElementById('userName').textContent = currentUser.username;
                document.getElementById('userAvatar').textContent = currentUser.username.charAt(0).toUpperCase();

                if (currentUser.role === 'admin') {
                    document.querySelectorAll('.admin-only').forEach(el => {
                        el.style.display = 'block';
                    });

                    // åŠ è½½ç®¡ç†é¢æ¿æ•°æ®
                    loadCategoryTagData();
                    loadCommentManagementData();
                    loadUserManagementData();
                    loadMusicManagementData();
                }
            }
        }

        // ç™»å‡ºåæ›´æ–°UI
        function updateUIAfterLogout() {
            document.getElementById('userInfo').style.display = 'none';
            document.getElementById('guestInfo').style.display = 'flex';
            document.querySelectorAll('.admin-only').forEach(el => {
                el.style.display = 'none';
            });

            // é‡ç½®æ”¶è—çŠ¶æ€
            Object.values(songsDatabase).forEach(song => {
                song.isFavorite = false;
            });
        }

        // æ‰“å¼€åˆ†ç±»æ ‡ç­¾æ¨¡æ€æ¡†
        function openCategoryTagModal(categoryTagId = null) {
            const modal = document.getElementById('categoryTagModal');
            const modalTitle = document.getElementById('categoryTagModalTitle');
            const deleteBtn = document.getElementById('deleteCategoryTagBtn');

            if (categoryTagId) {
                // ç¼–è¾‘æ¨¡å¼
                const categoryTag = categoryTagDatabase[categoryTagId];
                if (!categoryTag) return;

                modalTitle.textContent = 'ç¼–è¾‘åˆ†ç±»/æ ‡ç­¾';
                document.getElementById('categoryTagId').value = categoryTagId;
                document.getElementById('categoryTagName').value = categoryTag.name;
                document.getElementById('categoryTagType').value = categoryTag.type;
                document.getElementById('categoryTagDescription').value = categoryTag.description;

                deleteBtn.style.display = 'inline-block';
            } else {
                // æ·»åŠ æ¨¡å¼
                modalTitle.textContent = 'æ·»åŠ åˆ†ç±»/æ ‡ç­¾';
                document.getElementById('categoryTagId').value = '';
                document.getElementById('categoryTagName').value = '';
                document.getElementById('categoryTagType').value = 'category';
                document.getElementById('categoryTagDescription').value = '';

                deleteBtn.style.display = 'none';
            }

            modal.style.display = 'block';
        }

        // å…³é—­åˆ†ç±»æ ‡ç­¾æ¨¡æ€æ¡†
        function closeCategoryTagModal() {
            document.getElementById('categoryTagModal').style.display = 'none';
        }

        // ä¿å­˜åˆ†ç±»æ ‡ç­¾
        function saveCategoryTag() {
            const id = document.getElementById('categoryTagId').value;
            const name = document.getElementById('categoryTagName').value.trim();
            const type = document.getElementById('categoryTagType').value;
            const description = document.getElementById('categoryTagDescription').value.trim();

            if (!name) {
                alert('åç§°ä¸èƒ½ä¸ºç©º');
                return;
            }

            if (id) {
                // æ›´æ–°ç°æœ‰åˆ†ç±»æ ‡ç­¾
                categoryTagDatabase[id] = {
                    ...categoryTagDatabase[id],
                    name,
                    type,
                    description
                };
            } else {
                // åˆ›å»ºæ–°åˆ†ç±»æ ‡ç­¾
                const newId = Math.max(...Object.keys(categoryTagDatabase).map(Number)) + 1;
                categoryTagDatabase[newId] = {
                    id: newId,
                    name,
                    type,
                    description
                };
            }

            closeCategoryTagModal();
            loadCategoryTagData();
            alert('ä¿å­˜æˆåŠŸï¼');
        }

        // åˆ é™¤åˆ†ç±»æ ‡ç­¾
        function deleteCategoryTag() {
            const id = document.getElementById('categoryTagId').value;
            if (!id || !confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªåˆ†ç±»/æ ‡ç­¾å—ï¼Ÿ')) return;

            delete categoryTagDatabase[id];
            closeCategoryTagModal();
            loadCategoryTagData();
            alert('åˆ é™¤æˆåŠŸï¼');
        }

        // åŠ è½½åˆ†ç±»æ ‡ç­¾æ•°æ®
        function loadCategoryTagData() {
            const tableBody = document.getElementById('categoryTagTableBody');
            tableBody.innerHTML = '';

            Object.values(categoryTagDatabase).forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.id}</td>
                    <td>${item.name}</td>
                    <td>${item.type === 'category' ? 'åˆ†ç±»' : 'æ ‡ç­¾'}</td>
                    <td>${item.description}</td>
                    <td>
                        <button class="action-btn edit-btn" onclick="openCategoryTagModal(${item.id})">ç¼–è¾‘</button>
                        <button class="action-btn delete-btn" onclick="deleteCategoryTag(${item.id})">åˆ é™¤</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // åŠ è½½è¯„è®ºç®¡ç†æ•°æ®
        function loadCommentManagementData() {
            const tableBody = document.getElementById('commentTableBody');
            tableBody.innerHTML = '';

            Object.values(commentsDatabase).forEach(comment => {
                const song = songsDatabase[comment.songId] || { title: 'æœªçŸ¥æ­Œæ›²' };
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${comment.id}</td>
                    <td>${song.title}</td>
                    <td>${comment.username}</td>
                    <td>${comment.content.length > 30 ? comment.content.substring(0, 30) + '...' : comment.content}</td>
                    <td>${comment.time}</td>
                    <td>
                        <button class="action-btn edit-btn" onclick="editComment(${comment.id})">ç¼–è¾‘</button>
                        <button class="action-btn delete-btn" onclick="deleteComment(${comment.id})">åˆ é™¤</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // æ‰“å¼€ç”¨æˆ·æ¨¡æ€æ¡†
        function openUserModal(userId = null) {
            const modal = document.getElementById('userModal');
            const modalTitle = document.getElementById('userModalTitle');
            const deleteBtn = document.getElementById('deleteUserBtn');

            if (userId) {
                // ç¼–è¾‘æ¨¡å¼
                const user = usersDatabase[userId];
                if (!user) return;

                modalTitle.textContent = 'ç¼–è¾‘ç”¨æˆ·';
                document.getElementById('userId').value = userId;
                document.getElementById('userUsername').value = user.username;
                document.getElementById('userEmail').value = user.email;
                document.getElementById('userRole').value = user.role;

                deleteBtn.style.display = 'inline-block';
            } else {
                // æ·»åŠ æ¨¡å¼
                modalTitle.textContent = 'æ·»åŠ ç”¨æˆ·';
                document.getElementById('userId').value = '';
                document.getElementById('userUsername').value = '';
                document.getElementById('userEmail').value = '';
                document.getElementById('userRole').value = 'user';

                deleteBtn.style.display = 'none';
            }

            modal.style.display = 'block';
        }

        // å…³é—­ç”¨æˆ·æ¨¡æ€æ¡†
        function closeUserModal() {
            document.getElementById('userModal').style.display = 'none';
        }

        // ä¿å­˜ç”¨æˆ·
        function saveUser() {
            const id = document.getElementById('userId').value;
            const username = document.getElementById('userUsername').value.trim();
            const email = document.getElementById('userEmail').value.trim();
            const role = document.getElementById('userRole').value;

            if (!username || !email) {
                alert('ç”¨æˆ·åå’Œé‚®ç®±ä¸èƒ½ä¸ºç©º');
                return;
            }

            // è·å–å½“å‰æ—¶é—´
            const now = new Date();
            const formattedTime = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;

            if (id) {
                // æ›´æ–°ç°æœ‰ç”¨æˆ·
                usersDatabase[id] = {
                    ...usersDatabase[id],
                    username,
                    email,
                    role
                };
            } else {
                // åˆ›å»ºæ–°ç”¨æˆ·
                const newId = Math.max(...Object.keys(usersDatabase).map(Number)) + 1;
                usersDatabase[newId] = {
                    id: newId,
                    username,
                    email,
                    role,
                    password: '123456', // é»˜è®¤å¯†ç 
                    registerTime: formattedTime
                };
            }

            closeUserModal();
            loadUserManagementData();
            alert('ä¿å­˜æˆåŠŸï¼');
        }

        // åˆ é™¤ç”¨æˆ·
        function deleteUser() {
            const id = document.getElementById('userId').value;
            if (!id || !confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç”¨æˆ·å—ï¼Ÿ')) return;

            // ä¸èƒ½åˆ é™¤å½“å‰ç™»å½•ç”¨æˆ·
            if (currentUser && currentUser.id == id) {
                alert('ä¸èƒ½åˆ é™¤å½“å‰ç™»å½•çš„ç”¨æˆ·');
                return;
            }

            delete usersDatabase[id];
            closeUserModal();
            loadUserManagementData();
            alert('åˆ é™¤æˆåŠŸï¼');
        }

        // åŠ è½½ç”¨æˆ·ç®¡ç†æ•°æ®
        function loadUserManagementData() {
            const tableBody = document.getElementById('userTableBody');
            tableBody.innerHTML = '';

            Object.values(usersDatabase).forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.username}</td>
                    <td>${user.email}</td>
                    <td>${getRoleName(user.role)}</td>
                    <td>${user.registerTime}</td>
                    <td>
                        <button class="action-btn edit-btn" onclick="openUserModal(${user.id})">ç¼–è¾‘</button>
                        <button class="action-btn delete-btn" onclick="deleteUser(${user.id})">åˆ é™¤</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // è·å–è§’è‰²åç§°
        function getRoleName(role) {
            const roleNames = {
                'admin': 'ç®¡ç†å‘˜',
                'editor': 'ç¼–è¾‘',
                'user': 'æ™®é€šç”¨æˆ·'
            };
            return roleNames[role] || role;
        }

        // åŠ è½½éŸ³ä¹ç®¡ç†æ•°æ®
        function loadMusicManagementData() {
            const tableBody = document.getElementById('musicTableBody');
            tableBody.innerHTML = '';

            Object.values(songsDatabase).forEach(song => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${song.id}</td>
                    <td>${song.title}</td>
                    <td>${song.artist}</td>
                    <td>${song.album}</td>
                    <td>${song.genre}</td>
                    <td>
                        <button class="action-btn edit-btn" onclick="openMusicModal(${song.id})">ç¼–è¾‘</button>
                        <button class="action-btn delete-btn" onclick="deleteMusic(${song.id})">åˆ é™¤</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // æ‰“å¼€éŸ³ä¹ç¼–è¾‘æ¨¡æ€æ¡†
        function openMusicModal(musicId = null) {
            const modal = document.getElementById('musicModal');
            const modalTitle = document.getElementById('musicModalTitle');
            const deleteBtn = document.getElementById('deleteMusicBtn');

            if (musicId) {
                // ç¼–è¾‘æ¨¡å¼
                const music = songsDatabase[musicId];
                if (!music) return;

                modalTitle.textContent = 'ç¼–è¾‘éŸ³ä¹';
                document.getElementById('musicId').value = musicId;
                document.getElementById('musicTitle').value = music.title;
                document.getElementById('musicArtist').value = music.artist;
                document.getElementById('musicAlbum').value = music.album;
                document.getElementById('musicCover').value = music.cover;
                document.getElementById('musicAudio').value = music.audio;
                document.getElementById('musicDuration').value = music.duration;
                document.getElementById('musicGenre').value = music.genre;
                document.getElementById('musicLyrics').value = music.lyrics;

                deleteBtn.style.display = 'inline-block';
            } else {
                // æ·»åŠ æ¨¡å¼
                modalTitle.textContent = 'æ·»åŠ éŸ³ä¹';
                document.getElementById('musicId').value = '';
                document.getElementById('musicTitle').value = '';
                document.getElementById('musicArtist').value = '';
                document.getElementById('musicAlbum').value = '';
                document.getElementById('musicCover').value = '';
                document.getElementById('musicAudio').value = '';
                document.getElementById('musicDuration').value = '';
                document.getElementById('musicGenre').value = '';
                document.getElementById('musicLyrics').value = '';

                deleteBtn.style.display = 'none';
            }

            modal.style.display = 'block';
        }

        // å…³é—­éŸ³ä¹æ¨¡æ€æ¡†
        function closeMusicModal() {
            document.getElementById('musicModal').style.display = 'none';
        }

        // ä¿å­˜éŸ³ä¹
        function saveMusic() {
            const id = document.getElementById('musicId').value;
            const title = document.getElementById('musicTitle').value.trim();
            const artist = document.getElementById('musicArtist').value.trim();
            const album = document.getElementById('musicAlbum').value.trim();
            const cover = document.getElementById('musicCover').value.trim();
            const audio = document.getElementById('musicAudio').value.trim();
            const duration = document.getElementById('musicDuration').value.trim();
            const genre = document.getElementById('musicGenre').value.trim();
            const lyrics = document.getElementById('musicLyrics').value.trim();

            if (!title || !artist || !album || !cover || !audio || !duration || !genre || !lyrics) {
                alert('æ‰€æœ‰å­—æ®µéƒ½å¿…é¡»å¡«å†™');
                return;
            }

            if (id) {
                // æ›´æ–°ç°æœ‰éŸ³ä¹
                songsDatabase[id] = {
                    ...songsDatabase[id],
                    title,
                    artist,
                    album,
                    cover,
                    audio,
                    duration,
                    genre,
                    lyrics
                };
            } else {
                // åˆ›å»ºæ–°éŸ³ä¹
                const newId = Math.max(...Object.keys(songsDatabase).map(Number)) + 1;
                songsDatabase[newId] = {
                    id: newId,
                    title,
                    artist,
                    album,
                    cover,
                    audio,
                    duration,
                    genre,
                    lyrics,
                    relatedSongs: [],
                    isFavorite: false,
                    categories: [],
                    tags: []
                };
            }

            closeMusicModal();
            loadMusicManagementData();
            alert('ä¿å­˜æˆåŠŸï¼');
        }

        // åˆ é™¤éŸ³ä¹
        function deleteMusic(musicId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™é¦–éŸ³ä¹å—ï¼Ÿ')) return;

            delete songsDatabase[musicId];
            loadMusicManagementData();
            alert('åˆ é™¤æˆåŠŸï¼');
        }

        // æ˜¾ç¤ºæŒ‡å®šé¢æ¿
        function showPanel(panelId) {
            // éšè—æ‰€æœ‰é¢æ¿
            document.querySelectorAll('.management-panel, #recommendation-panel').forEach(panel => {
                panel.style.display = 'none';
            });

            // æ˜¾ç¤ºæŒ‡å®šé¢æ¿
            document.getElementById(panelId).style.display = 'block';

            // å¦‚æœæ˜¯ç®¡ç†é¢æ¿ï¼ŒåŠ è½½ç›¸åº”æ•°æ®
            if (panelId === 'category-tag-panel') {
                loadCategoryTagData();
            } else if (panelId === 'comment-panel') {
                loadCommentManagementData();
            } else if (panelId === 'user-panel') {
                loadUserManagementData();
            } else if (panelId === 'favorites-panel' && currentUser) {
                loadFavorites();
            } else if (panelId === 'music-panel') {
                loadMusicManagementData();
            }

            // æ›´æ–°å¯¼èˆªé¡¹activeçŠ¶æ€
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            const currentNavItem = document.querySelector(`.nav-item[onclick="showPanel('${panelId}')"]`);
            if (currentNavItem) {
                currentNavItem.classList.add('active');
            }
        }
    </script>
</body>
</html>