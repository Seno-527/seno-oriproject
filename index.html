<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>音乐推荐系统</title>
    <style>
        :root {
            --bg-color: #01B3C9;
            --sidebar-color: #7CE4E5;
            --card-color: #4AC8D8;
            --text-color: #FAF8E8;
            --secondary-text: #E8E6D9;
            --accent-color: #FFD83B;
            --active-accent: #FFE45E;
            --sidebar-text: #191814;
            --title-color: #F5F5DC;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.5;
            margin: 0;
            display: grid;
            grid-template-columns: 220px 1fr;
            min-height: 100vh;
        }

        /* 全局播放器样式 */
        .global-player {
            position: fixed;
            bottom: 0;
            left: 220px;
            right: 0;
            background: var(--card-color);
            padding: 10px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 100;
            display: none;
            transition: transform 0.3s ease;
        }

        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .close-player {
            cursor: pointer;
            color: var(--secondary-text);
            font-size: 18px;
            padding: 5px;
        }

        /* 侧边栏样式 */
        .sidebar {
            background-color: var(--sidebar-color);
            color: var(--sidebar-text);
            padding: 20px 0;
        }

        .logo {
            font-size: 20px;
            font-weight: bold;
            text-align: center;
            padding: 20px;
            margin-bottom: 30px;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            color: var(--sidebar-text);
        }

        .nav-menu {
            list-style: none;
            padding: 0;
        }

        .nav-item {
            padding: 12px 25px;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            color: var(--sidebar-text);
        }

        .nav-item:hover {
            background-color: rgba(0,0,0,0.1);
        }

        .nav-item.active {
            background-color: var(--accent-color);
            color: var(--sidebar-color);
        }

        /* 主内容区样式 */
        .main-content {
            padding: 30px;
            background-color: var(--bg-color);
        }

        /* 音乐网格布局 */
        .music-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 20px;
        }

        /* 音乐卡片样式 */
        .music-card {
            background-color: var(--card-color);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            height: 100%;
            transition: transform 0.3s;
        }

        .music-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.12);
        }

        .album-cover-container {
            position: relative;
            width: 100%;
            height: 240px;
            overflow: hidden;
        }

        .album-cover {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .music-card:hover .album-cover {
            transform: scale(1.05);
        }

        .music-info {
            padding: 15px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .song-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--text-color);
            cursor: pointer;
            transition: color 0.2s;
        }

        .song-title:hover {
            color: var(--accent-color);
        }

        .song-meta {
            font-size: 13px;
            color: var(--secondary-text);
            margin-bottom: 12px;
            flex-grow: 1;
        }

        .play-control {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(255,255,255,0.2);
        }

        .play-btn {
            background-color: var(--accent-color);
            color: var(--sidebar-text);
            border: none;
            padding: 6px 15px;
            border-radius: 15px;
            font-size: 13px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .play-btn:hover {
            background-color: var(--active-accent);
        }

        .favorite-btn {
            background: none;
            border: none;
            color: var(--secondary-text);
            font-size: 16px;
            cursor: pointer;
            padding: 0 8px;
            transition: all 0.2s;
        }

        .favorite-btn.favorited {
            color: #ff4081;
        }

        /* 模态框样式 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: var(--card-color);
            margin: 10% auto;
            padding: 20px;
            border-radius: 8px;
            width: 350px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .close {
            color: var(--secondary-text);
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 4px;
            box-sizing: border-box;
            background-color: rgba(255,255,255,0.1);
            color: var(--text-color);
        }

        .form-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
        }

        .btn-primary {
            background-color: var(--accent-color);
            color: var(--sidebar-text);
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-danger {
            background-color: #ff5252;
            color: white;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: var(--accent-color);
            color: var(--sidebar-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .login-btn {
            background: none;
            border: none;
            color: var(--sidebar-text);
            cursor: pointer;
            font-weight: 600;
        }

        .register-btn {
            background: none;
            border: none;
            color: var(--accent-color);
            cursor: pointer;
            font-weight: 600;
        }

        .admin-only {
            display: none;
        }

        /* 歌曲详情样式 */
        .back-to-list {
            color: var(--accent-color);
            cursor: pointer;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .song-detail-header {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .song-detail-cover {
            width: 200px;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
        }

        .song-detail-info {
            flex: 1;
        }

        .song-detail-title {
            font-size: 24px;
            margin-bottom: 8px;
            color: var(--text-color);
        }

        .song-detail-artist {
            font-size: 18px;
            margin-bottom: 15px;
            color: var(--secondary-text);
        }

        .song-detail-meta {
            margin-bottom: 20px;
        }

        .song-detail-meta-item {
            margin-bottom: 8px;
            display: flex;
        }

        .song-detail-meta-label {
            font-weight: bold;
            width: 60px;
            color: var(--secondary-text);
        }

        .song-detail-meta-value {
            flex: 1;
        }

        .song-detail-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .song-detail-content {
            margin-top: 30px;
        }

        .song-detail-lyrics {
            white-space: pre-line;
            line-height: 1.8;
            margin-bottom: 30px;
        }

        /* 评论区域样式 */
        .comments-section {
            margin-top: 40px;
        }

        .comments-title {
            font-size: 20px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .comment-form {
            margin-bottom: 30px;
        }

        .comment-input {
            width: 100%;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid rgba(255,255,255,0.3);
            background-color: rgba(255,255,255,0.1);
            color: var(--text-color);
            margin-bottom: 10px;
            min-height: 80px;
        }

        .comment-submit {
            background-color: var(--accent-color);
            color: var(--sidebar-text);
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .comment-list {
            list-style: none;
        }

        .comment-item {
            padding: 15px;
            background-color: rgba(255,255,255,0.1);
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .comment-user {
            font-weight: bold;
            color: var(--accent-color);
        }

        .comment-time {
            font-size: 12px;
            color: var(--secondary-text);
        }

        .comment-content {
            margin-bottom: 10px;
        }

        .comment-actions {
            display: flex;
            gap: 10px;
            font-size: 12px;
        }

        .comment-action {
            color: var(--secondary-text);
            cursor: pointer;
        }

        .comment-action:hover {
            color: var(--accent-color);
        }

        /* 管理面板样式 */
        .management-panel {
            display: none;
        }

        .panel-header {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .panel-title {
            font-size: 24px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table th, .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .data-table th {
            background-color: rgba(255,255,255,0.1);
            font-weight: bold;
        }

        .data-table tr:hover {
            background-color: rgba(255,255,255,0.05);
        }

        .action-btn {
            padding: 5px 10px;
            margin-right: 5px;
            border-radius: 3px;
            cursor: pointer;
            border: none;
        }

        .edit-btn {
            background-color: var(--accent-color);
            color: var(--sidebar-text);
        }

        .delete-btn {
            background-color: #ff5252;
            color: white;
        }

        .add-btn {
            background-color: var(--accent-color);
            color: var(--sidebar-text);
            padding: 8px 16px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            margin-bottom: 20px;
        }

        /* 标签样式 */
        .tag {
            display: inline-block;
            padding: 2px 8px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            font-size: 12px;
            margin-right: 5px;
            margin-bottom: 5px;
        }

        /* 切换表单样式 */
        .auth-form-toggle {
            text-align: center;
            margin-top: 15px;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            body {
                grid-template-columns: 1fr;
            }
            .sidebar {
                display: none;
            }
            .music-grid {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            }
            .album-cover-container {
                height: 180px;
            }
            .global-player {
                left: 0;
            }
            .modal-content {
                width: 90%;
                margin: 20% auto;
            }
            .song-detail-header {
                flex-direction: column;
            }
            .song-detail-cover {
                width: 100%;
                height: auto;
                max-height: 300px;
            }
        }
    </style>
</head>
<body>
    <!-- 全局播放器 -->
    <div class="global-player" id="globalPlayer">
        <div class="player-header">
            <div id="currentPlaying">正在播放: <span id="currentSongTitle">--</span> - <span id="currentSongArtist">--</span></div>
            <span class="close-player" onclick="closePlayer()">&times;</span>
        </div>
        <audio controls id="audioPlayer" style="width:100%"></audio>
    </div>

    <!-- 登录/注册模态框 -->
    <div id="authModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAuthModal()">&times;</span>
            <h2 id="modalTitle">用户登录</h2>
            <form id="authForm">
                <div class="form-group">
                    <label for="username">用户名</label>
                    <input type="text" id="username" name="username" required>
                </div>
                <div class="form-group">
                    <label for="password">密码</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <div id="confirmPasswordGroup" class="form-group" style="display: none;">
                    <label for="confirmPassword">确认密码</label>
                    <input type="password" id="confirmPassword" name="confirmPassword">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-primary" id="authSubmitBtn" onclick="submitAuthForm()">登录</button>
                </div>
                <div class="auth-form-toggle">
                    <span id="toggleAuthFormText">还没有账号？</span>
                    <button type="button" class="register-btn" id="toggleAuthFormBtn" onclick="toggleAuthForm()">立即注册</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 分类标签编辑模态框 -->
    <div id="categoryTagModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCategoryTagModal()">&times;</span>
            <h2 id="categoryTagModalTitle">添加分类标签</h2>
            <form id="categoryTagForm">
                <input type="hidden" id="categoryTagId">
                <div class="form-group">
                    <label for="categoryTagName">名称</label>
                    <input type="text" id="categoryTagName" required>
                </div>
                <div class="form-group">
                    <label for="categoryTagType">类型</label>
                    <select id="categoryTagType" required>
                        <option value="category">分类</option>
                        <option value="tag">标签</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="categoryTagDescription">描述</label>
                    <textarea id="categoryTagDescription" rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-danger" id="deleteCategoryTagBtn" style="display:none;" onclick="deleteCategoryTag()">删除</button>
                    <button type="button" class="btn btn-primary" onclick="saveCategoryTag()">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 评论编辑模态框 -->
    <div id="commentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCommentModal()">&times;</span>
            <h2 id="commentModalTitle">编辑评论</h2>
            <form id="commentForm">
                <input type="hidden" id="commentId">
                <input type="hidden" id="commentSongId">
                <div class="form-group">
                    <label for="commentContent">评论内容</label>
                    <textarea id="commentContent" rows="5" required></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-danger" onclick="deleteComment()">删除</button>
                    <button type="button" class="btn btn-primary" onclick="saveComment()">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 用户编辑模态框 -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeUserModal()">&times;</span>
            <h2 id="userModalTitle">添加用户</h2>
            <form id="userForm">
                <input type="hidden" id="userId">
                <div class="form-group">
                    <label for="userUsername">用户名</label>
                    <input type="text" id="userUsername" required>
                </div>
                <div class="form-group">
                    <label for="userEmail">邮箱</label>
                    <input type="email" id="userEmail" required>
                </div>
                <div class="form-group">
                    <label for="userRole">角色</label>
                    <select id="userRole" required>
                        <option value="user">普通用户</option>
                        <option value="admin">管理员</option>
                        <option value="editor">编辑</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-danger" id="deleteUserBtn" style="display:none;" onclick="deleteUser()">删除</button>
                    <button type="button" class="btn btn-primary" onclick="saveUser()">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 音乐编辑模态框 -->
    <div id="musicModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeMusicModal()">&times;</span>
            <h2 id="musicModalTitle">添加音乐</h2>
            <form id="musicForm">
                <input type="hidden" id="musicId">
                <div class="form-group">
                    <label for="musicTitle">歌曲名称</label>
                    <input type="text" id="musicTitle" required>
                </div>
                <div class="form-group">
                    <label for="musicArtist">艺术家</label>
                    <input type="text" id="musicArtist" required>
                </div>
                <div class="form-group">
                    <label for="musicAlbum">专辑</label>
                    <input type="text" id="musicAlbum" required>
                </div>
                <div class="form-group">
                    <label for="musicCover">封面URL</label>
                    <input type="text" id="musicCover" required>
                </div>
                <div class="form-group">
                    <label for="musicAudio">音频URL</label>
                    <input type="text" id="musicAudio" required>
                </div>
                <div class="form-group">
                    <label for="musicDuration">时长</label>
                    <input type="text" id="musicDuration" required>
                </div>
                <div class="form-group">
                    <label for="musicGenre">流派</label>
                    <input type="text" id="musicGenre" required>
                </div>
                <div class="form-group">
                    <label for="musicLyrics">歌词</label>
                    <textarea id="musicLyrics" rows="5" required></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-danger" id="deleteMusicBtn" style="display:none;" onclick="deleteMusic()">删除</button>
                    <button type="button" class="btn btn-primary" onclick="saveMusic()">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 侧边导航 -->
    <nav class="sidebar">
        <div class="logo">音乐推荐系统</div>
        <div class="user-info" id="userInfo" style="display:none; padding: 0 25px 20px; border-bottom: 1px solid rgba(0,0,0,0.1);">
            <div class="user-avatar" id="userAvatar">A</div>
            <span id="userName">管理员</span>
            <button class="login-btn" onclick="logout()">退出</button>
        </div>
        <div class="user-info" id="guestInfo" style="padding: 0 25px 20px; border-bottom: 1px solid rgba(0,0,0,0.1);">
            <button class="login-btn" onclick="openAuthModal('login')">用户登录</button>
            <button class="register-btn" onclick="openAuthModal('register')">用户注册</button>
        </div>
        <ul class="nav-menu">
            <li class="nav-item active" onclick="showPanel('recommendation-panel')">
                <i>🎵</i>音乐推荐
            </li>
            <li class="nav-item" onclick="showPanel('favorites-panel')">
                <i>❤️</i>我的收藏
            </li>
            <li class="nav-item admin-only" onclick="showPanel('music-panel')">
                <i>🎼</i>音乐管理
            </li>
            <li class="nav-item admin-only" onclick="showPanel('category-tag-panel')">
                <i>🗂️</i>分类标签管理
            </li>
            <li class="nav-item admin-only" onclick="showPanel('user-panel')">
                <i>👥</i>用户管理
            </li>
            <li class="nav-item admin-only" onclick="showPanel('comment-panel')">
                <i>💬</i>评论管理
            </li>
            <li class="nav-item admin-only" onclick="showPanel('operation-panel')">
                <i>📊</i>运营管理
            </li>
            <li class="nav-item admin-only" onclick="showPanel('log-panel')">
                <i>📝</i>日志管理
            </li>
            <li class="nav-item admin-only" onclick="showPanel('system-panel')">
                <i>⚙️</i>系统信息
            </li>
        </ul>
    </nav>

    <!-- 主内容区 -->
    <main class="main-content">
        <!-- 推荐面板 -->
        <div id="recommendation-panel">
            <div class="recommendation-header">
                <h1 class="recommendation-title">今日音乐推荐</h1>
                <p class="recommendation-subtitle">发现最新最热的音乐作品</p>
            </div>

            <div class="music-grid">
                <!-- 示例音乐卡片1 -->
                <div class="music-card">
                    <div class="album-cover-container">
                        <img src="static/covers/our_summer.jpg" alt="Our Summer" class="album-cover">
                    </div>
                    <div class="music-info">
                        <h3 class="song-title" onclick="showSongDetail(1)">Our Summer</h3>
                        <div class="song-meta">
                            <span class="song-artist">TXT</span>
                            <span class="song-album">K-pop</span>
                        </div>
                        <div class="play-control">
                            <span class="duration">3:30</span>
                            <button class="play-btn" onclick="playSong(1, 'Our Summer', 'TXT')">
                                播放
                            </button>
                            <button class="favorite-btn" onclick="toggleFavorite(1, this)">
                                ♡
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 示例音乐卡片2 -->
                <div class="music-card">
                    <div class="album-cover-container">
                        <img src="static/covers/run_free.jpg" alt="Run Free" class="album-cover">
                    </div>
                    <div class="music-info">
                        <h3 class="song-title" onclick="showSongDetail(2)">Run Free</h3>
                        <div class="song-meta">
                            <span class="song-artist">Deep Chills</span>
                            <span class="song-album">Pop</span>
                        </div>
                        <div class="play-control">
                            <span class="duration">2:50</span>
                            <button class="play-btn" onclick="playSong(2, 'Run Free', 'Deep Chills')">
                                播放
                            </button>
                            <button class="favorite-btn" onclick="toggleFavorite(2, this)">
                                ♡
                            </button>
                        </div>
                    </div>
                </div>

                <div class="music-card">
                    <div class="album-cover-container">
                        <img src="static/covers/barricades.jpg" alt="Barricades" class="album-cover">
                    </div>
                    <div class="music-info">
                        <h3 class="song-title" onclick="showSongDetail(3)">Barricades</h3>
                        <div class="song-meta">
                            <span class="song-artist">泽野弘之</span>
                            <span class="song-album">Pop</span>
                        </div>
                        <div class="play-control">
                            <span class="duration">3:41</span>
                            <button class="play-btn" onclick="playSong(3, 'Barricades', '泽野弘之')">
                                播放
                            </button>
                            <button class="favorite-btn" onclick="toggleFavorite(3, this)">
                                ♡
                            </button>
                        </div>
                    </div>
                </div>
                <div class="music-card">
                    <div class="album-cover-container">
                        <img src="static/covers/lwymmd.jpg" alt="Look You What Made Me Do" class="album-cover">
                    </div>
                    <div class="music-info">
                        <h3 class="song-title" onclick="showSongDetail(4)">Look You What Made Me Do</h3>
                        <div class="song-meta">
                            <span class="song-artist">Taylor Swift</span>
                            <span class="song-album">Pop</span>
                        </div>
                        <div class="play-control">
                            <span class="duration">3:31</span>
                            <button class="play-btn" onclick="playSong(4, 'Look You What Made Me Do', 'Taylor Swift')">
                                播放
                            </button>
                            <button class="favorite-btn" onclick="toggleFavorite(4, this)">
                                ♡
                            </button>
                        </div>
                    </div>
                </div>
                <div class="music-card">
                    <div class="album-cover-container">
                        <img src="static/covers/winter_feels.jpg" alt="this is what winter feels like" class="album-cover">
                    </div>
                    <div class="music-info">
                        <h3 class="song-title" onclick="showSongDetail(5)">this is what winter feels like</h3>
                        <div class="song-meta">
                            <span class="song-artist">JVKE</span>
                            <span class="song-album">pop</span>
                        </div>
                        <div class="play-control">
                            <span class="duration">3:14</span>
                            <button class="play-btn" onclick="playSong(5, 'this is what winter feels like', 'JVKE')">
                                播放
                            </button>
                            <button class="favorite-btn" onclick="toggleFavorite(5, this)">
                                ♡
                            </button>
                        </div>
                    </div>
                </div>
                <div class="music-card">
                    <div class="album-cover-container">
                        <img src="static/covers/counting_stars.jpg" alt="Counting Stars" class="album-cover">
                    </div>
                    <div class="music-info">
                        <h3 class="song-title" onclick="showSongDetail(6)">Counting Stars</h3>
                        <div class="song-meta">
                            <span class="song-artist">One Republics</span>
                            <span class="song-album">pop</span>
                        </div>
                        <div class="play-control">
                            <span class="duration">4:17</span>
                            <button class="play-btn" onclick="playSong(6, 'Counting Stars', 'One Republics')">
                                播放
                            </button>
                            <button class="favorite-btn" onclick="toggleFavorite(6, this)">
                                ♡
                            </button>
                        </div>
                    </div>
                </div>
                <div class="music-card">
                    <div class="album-cover-container">
                        <img src="static/covers/lose_my_mind.jpg" alt="Lose My Mind" class="album-cover">
                    </div>
                    <div class="music-info">
                        <h3 class="song-title" onclick="showSongDetail(7)">Lose My Mind</h3>
                        <div class="song-meta">
                            <span class="song-artist">Don Toliver;Doja Cat</span>
                            <span class="song-album">pop</span>
                        </div>
                        <div class="play-control">
                            <span class="duration">3:29</span>
                            <button class="play-btn" onclick="playSong(7, 'Lose My Mind', 'Don Toliver;Doja Cat')">
                                播放
                            </button>
                            <button class="favorite-btn" onclick="toggleFavorite(7, this)">
                                ♡
                            </button>
                        </div>
                    </div>
                </div>
                <div class="music-card">
                    <div class="album-cover-container">
                        <img src="static/covers/shape_of_you.jpg" alt="Shape of you" class="album-cover">
                    </div>
                    <div class="music-info">
                        <h3 class="song-title" onclick="showSongDetail(8)">Shape of You</h3>
                        <div class="song-meta">
                            <span class="song-artist">Ed Sheeran</span>
                            <span class="song-album">pop</span>
                        </div>
                        <div class="play-control">
                            <span class="duration">3:53</span>
                            <button class="play-btn" onclick="playSong(8, 'Shape of You', 'Ed Sheeran')">
                                播放
                            </button>
                            <button class="favorite-btn" onclick="toggleFavorite(8, this)">
                                ♡
                            </button>
                        </div>
                    </div>
                </div>
                <div class="music-card">
                    <div class="album-cover-container">
                        <img src="static/covers/afterglow.jpg" alt="Afterglow" class="album-cover">
                    </div>
                    <div class="music-info">
                        <h3 class="song-title" onclick="showSongDetail(9)">Afterglow</h3>
                        <div class="song-meta">
                            <span class="song-artist">Taylor Swift</span>
                            <span class="song-album">pop</span>
                        </div>
                        <div class="play-control">
                            <span class="duration">3:43</span>
                            <button class="play-btn" onclick="playSong(9, 'Afterglow', 'Taylor Swift')">
                                播放
                            </button>
                            <button class="favorite-btn" onclick="toggleFavorite(9, this)">
                                ♡
                            </button>
                        </div>
                    </div>
                </div>
                <div class="music-card">
                    <div class="album-cover-container">
                        <img src="static/covers/forever.jpg" alt="Forever" class="album-cover">
                    </div>
                    <div class="music-info">
                        <h3 class="song-title" onclick="showSongDetail(10)">Forever</h3>
                        <div class="song-meta">
                            <span class="song-artist">keshi</span>
                            <span class="song-album">K-pop</span>
                        </div>
                        <div class="play-control">
                            <span class="duration">2:51</span>
                            <button class="play-btn" onclick="playSong(10, 'Forever', 'keshi')">
                                播放
                            </button>
                            <button class="favorite-btn" onclick="toggleFavorite(10, this)">
                                ♡
                            </button>
                        </div>
                    </div>
                </div>
                <div class="music-card">
                    <div class="album-cover-container">
                        <img src="static/covers/koi_o_oikakete.jpg" alt="コウを追いかけて" class="album-cover">
                    </div>
                    <div class="music-info">
                        <h3 class="song-title" onclick="showSongDetail(11)">コウを追いかけて</h3>
                        <div class="song-meta">
                            <span class="song-artist">坂本秀一</span>
                            <span class="song-album">纯音乐</span>
                        </div>
                        <div class="play-control">
                            <span class="duration">1:55</span>
                            <button class="play-btn" onclick="playSong(11, 'コウを追いかけて', '坂本秀一')">
                                播放
                            </button>
                            <button class="favorite-btn" onclick="toggleFavorite(11, this)">
                                ♡
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="load-more-trigger">
                <div class="loading-spinner"></div> 加载更多...
            </div>
        </div>

        <!-- 收藏面板 -->
        <div id="favorites-panel" class="management-panel">
            <div class="panel-header">
                <h2 class="panel-title">我的收藏</h2>
                <p>您收藏的音乐作品</p>
            </div>
            <div class="music-grid" id="favorites-grid">
                <!-- 收藏的音乐卡片将通过JavaScript动态加载 -->
            </div>
            <div id="no-favorites" style="text-align: center; padding: 40px; display: none;">
                <p>您还没有收藏任何音乐</p>
                <button class="play-btn" onclick="showPanel('recommendation-panel')">去发现音乐</button>
            </div>
        </div>

        <!-- 音乐管理面板 -->
        <div id="music-panel" class="management-panel">
            <div class="panel-header">
                <h2 class="panel-title">音乐管理</h2>
                <p>管理音乐库中的所有音乐</p>
            </div>
            <button class="add-btn" onclick="openMusicModal()">添加音乐</button>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>歌曲名称</th>
                        <th>艺术家</th>
                        <th>专辑</th>
                        <th>流派</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="musicTableBody">
                    <!-- 音乐数据将通过JavaScript动态加载 -->
                </tbody>
            </table>
        </div>

        <!-- 分类标签管理面板 -->
        <div id="category-tag-panel" class="management-panel">
            <div class="panel-header">
                <h2 class="panel-title">分类标签管理</h2>
            </div>
            <button class="add-btn" onclick="openCategoryTagModal()">添加分类/标签</button>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>名称</th>
                        <th>类型</th>
                        <th>描述</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="categoryTagTableBody">
                    <!-- 分类标签数据将通过JavaScript动态加载 -->
                </tbody>
            </table>
        </div>

        <!-- 用户管理面板 -->
        <div id="user-panel" class="management-panel">
            <div class="panel-header">
                <h2 class="panel-title">用户管理</h2>
            </div>
            <button class="add-btn" onclick="openUserModal()">添加用户</button>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>用户名</th>
                        <th>邮箱</th>
                        <th>角色</th>
                        <th>注册时间</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="userTableBody">
                    <!-- 用户数据将通过JavaScript动态加载 -->
                </tbody>
            </table>
        </div>

        <!-- 评论管理面板 -->
        <div id="comment-panel" class="management-panel">
            <div class="panel-header">
                <h2 class="panel-title">评论管理</h2>
            </div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>歌曲</th>
                        <th>用户</th>
                        <th>评论内容</th>
                        <th>时间</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="commentTableBody">
                    <!-- 评论数据将通过JavaScript动态加载 -->
                </tbody>
            </table>
        </div>

        <!-- 运营管理面板 -->
        <div id="operation-panel" class="management-panel">
            <div class="panel-header">
                <h2 class="panel-title">运营管理</h2>
            </div>
            <div class="operation-content">
                <p>运营数据统计和分析将显示在这里。</p>
            </div>
        </div>

        <!-- 日志管理面板 -->
        <div id="log-panel" class="management-panel">
            <div class="panel-header">
                <h2 class="panel-title">日志管理</h2>
            </div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>时间</th>
                        <th>用户</th>
                        <th>操作</th>
                        <th>详情</th>
                    </tr>
                </thead>
                <tbody id="logTableBody">
                    <!-- 日志数据将通过JavaScript动态加载 -->
                </tbody>
            </table>
        </div>

        <!-- 系统信息面板 -->
        <div id="system-panel" class="management-panel">
            <div class="panel-header">
                <h2 class="panel-title">系统信息</h2>
            </div>
            <div class="system-info">
                <p>系统版本: 1.0.0</p>
                <p>服务器状态: 运行中</p>
                <p>数据库状态: 正常</p>
                <p>最后备份: 2023-05-15</p>
            </div>
        </div>
    </main>

    <script>
        // 当前登录用户
        let currentUser = null;
        // 当前播放歌曲
        let currentSong = null;
        // 模拟歌曲数据库
        const songsDatabase = {
            1: {
                id: 1,
                title: "Our Summer",
                artist: "TXT",
                album: "The Dream Chapter: MAGIC",
                cover: "static/covers/our_summer.jpg",
                audio: "static/audio/song1.mp3",
                duration: "3:30",
                genre: "K-pop",
                releaseDate: "2019-10-21",
                lyrics: `[Verse 1]
It's you and me in this moment
Don't ever let it fade away
The way you look under the moonlight
I wanna stay here every day`,
                relatedSongs: [2, 5, 10],
                isFavorite: false,
                categories: ["K-pop", "流行"],
                tags: ["夏日", "青春"]
            },
            2: {
                id: 2,
                title: "Run Free",
                artist: "Deep Chills",
                album: "Single",
                cover: "static/covers/run_free.jpg",
                audio: "static/audio/song2.mp3",
                duration: "2:50",
                genre: "Pop",
                releaseDate: "2020-05-15",
                lyrics: `[Verse 1]
Running through the night
Feel the wind in your hair
Nothing can stop us now
We're free as the air`,
                relatedSongs: [1, 3],
                isFavorite: false,
                categories: ["电子", "流行"],
                tags: ["自由", "奔跑"]
            },
            3: {
                id: 3,
                title: "Barricades",
                artist: "泽野弘之",
                album: "Attack on Titan OST",
                cover: "static/covers/barricades.jpg",
                audio: "static/audio/song3.mp3",
                duration: "3:41",
                genre: "Anime",
                releaseDate: "2017-06-07",
                lyrics: `[Verse 1]
Standing in the ruins
Of what we used to be
The walls have all come down
But we're still not free`,
                relatedSongs: [2, 4],
                isFavorite: false,
                categories: ["动漫", "原声"],
                tags: ["战斗", "史诗"]
            },
            4: {
                id: 4,
                title: "Look You What Made Me Do",
                artist: "Taylor Swift",
                album: "Reputation",
                cover: "static/covers/lwymmd.jpg",
                audio: "static/audio/song4.mp3",
                duration: "3:31",
                genre: "Pop",
                releaseDate: "2017-08-25",
                lyrics: `[Verse 1]
I don't like your little games
Don't like your tilted stage
The role you made me play
Of the fool, no, I don't like you`,
                relatedSongs: [1, 5],
                isFavorite: false,
                categories: ["流行"],
                tags: ["复仇", "流行"]
            },
            5: {
                id: 5,
                title: "this is what winter feels like",
                artist: "JVKE",
                album: "this is what winter feels like",
                cover: "static/covers/winter_feels.jpg",
                audio: "static/audio/song5.mp3",
                duration: "3:14",
                genre: "Pop",
                releaseDate: "2022-12-09",
                lyrics: `[Verse 1]
Snowflakes falling down
Like confetti on the ground
The air is getting colder now
But I don't mind it with you around`,
                relatedSongs: [4, 6],
                isFavorite: false,
                categories: ["流行"],
                tags: ["冬季", "浪漫"]
            },
            6: {
                id: 6,
                title: "Counting Stars",
                artist: "One Republic",
                album: "Native",
                cover: "static/covers/counting_stars.jpg",
                audio: "static/audio/song6.mp3",
                duration: "4:17",
                genre: "Pop",
                releaseDate: "2013-06-14",
                lyrics: `[Verse 1]
Lately, I've been, I've been losing sleep
Dreaming about the things that we could be
But baby, I've been, I've been praying hard
Said no more counting dollars
We'll be counting stars`,
                relatedSongs: [5, 7],
                isFavorite: false,
                categories: ["流行"],
                tags: ["励志", "梦想"]
            },
            7: {
                id: 7,
                title: "Lose My Mind",
                artist: "Don Toliver;Doja Cat",
                album: "Life of a DON",
                cover: "static/covers/lose_my_mind.jpg",
                audio: "static/audio/song7.mp3",
                duration: "3:29",
                genre: "Pop",
                releaseDate: "2021-10-08",
                lyrics: `[Verse 1]
I lose my mind when I'm with you
I lose my mind when I'm with you
I lose my mind when I'm with you
I lose my mind when I'm with you`,
                relatedSongs: [6, 8],
                isFavorite: false,
                categories: ["流行"],
                tags: ["爱情", "疯狂"]
            },
            8: {
                id: 8,
                title: "Shape of You",
                artist: "Ed Sheeran",
                album: "÷",
                cover: "static/covers/shape_of_you.jpg",
                audio: "static/audio/song8.mp3",
                duration: "3:53",
                genre: "Pop",
                releaseDate: "2017-01-06",
                lyrics: `[Verse 1]
The club isn't the best place to find a lover
So the bar is where I go
Me and my friends at the table doing shots
Drinking fast and then we talk slow`,
                relatedSongs: [7, 9],
                isFavorite: false,
                categories: ["流行"],
                tags: ["爱情", "舞曲"]
            },
            9: {
                id: 9,
                title: "Afterglow",
                artist: "Taylor Swift",
                album: "Lover",
                cover: "static/covers/afterglow.jpg",
                audio: "static/audio/song9.mp3",
                duration: "3:43",
                genre: "Pop",
                releaseDate: "2019-12-15",
                lyrics: `[Verse 1]
Fighting with a true love is boxing with no gloves
Chemistry 'til it blows up, 'til there's no us
Why'd I have to break what I love so much?
It's on your face, and I'm to blame, I need to say`,
                relatedSongs: [8, 10],
                isFavorite: false,
                categories: ["流行"],
                tags: ["爱情", "和解"]
            },
            10: {
                id: 10,
                title: "Forever",
                artist: "keshi",
                album: "always",
                cover: "static/covers/forever.jpg",
                audio: "static/audio/song10.mp3",
                duration: "2:51",
                genre: "K-pop",
                releaseDate: "2020-12-11",
                lyrics: `[Verse 1]
I don't wanna wait another day
I don't wanna wait another night
I don't wanna wait another life
To be with you`,
                relatedSongs: [9, 1],
                isFavorite: false,
                categories: ["K-pop"],
                tags: ["永恒", "爱情"]
            },
            11: {
                id: 11,
                title: "コウを追いかけて",
                artist: "坂本秀一",
                album: "純音楽",
                cover: "static/covers/koi_o_oikakete.jpg",
                audio: "static/audio/song11.mp3",
                duration: "1:55",
                genre: "纯音乐",
                releaseDate: "2020-05-20",
                lyrics: "",
                relatedSongs: [10, 1],
                isFavorite: false,
                categories: ["纯音乐"],
                tags: ["治愈", "安静"]
            }
        };

        // 模拟分类标签数据库
        const categoryTagDatabase = {
            1: { id: 1, name: "K-pop", type: "category", description: "韩国流行音乐" },
            2: { id: 2, name: "流行", type: "category", description: "流行音乐" },
            3: { id: 3, name: "电子", type: "category", description: "电子音乐" },
            4: { id: 4, name: "动漫", type: "category", description: "动漫音乐" },
            5: { id: 5, name: "原声", type: "category", description: "影视原声音乐" },
            6: { id: 6, name: "纯音乐", type: "category", description: "纯音乐作品" },
            7: { id: 7, name: "夏日", type: "tag", description: "适合夏天的音乐" },
            8: { id: 8, name: "青春", type: "tag", description: "青春主题音乐" },
            9: { id: 9, name: "自由", type: "tag", description: "自由主题音乐" },
            10: { id: 10, name: "奔跑", type: "tag", description: "运动跑步音乐" },
            11: { id: 11, name: "战斗", type: "tag", description: "战斗主题音乐" },
            12: { id: 12, name: "史诗", type: "tag", description: "史诗风格音乐" },
            13: { id: 13, name: "复仇", type: "tag", description: "复仇主题音乐" },
            14: { id: 14, name: "冬季", type: "tag", description: "冬季主题音乐" },
            15: { id: 15, name: "浪漫", type: "tag", description: "浪漫主题音乐" },
            16: { id: 16, name: "励志", type: "tag", description: "励志主题音乐" },
            17: { id: 17, name: "梦想", type: "tag", description: "梦想主题音乐" },
            18: { id: 18, name: "爱情", type: "tag", description: "爱情主题音乐" },
            19: { id: 19, name: "疯狂", type: "tag", description: "疯狂主题音乐" },
            20: { id: 20, name: "舞曲", type: "tag", description: "适合跳舞的音乐" },
            21: { id: 21, name: "和解", type: "tag", description: "和解主题音乐" },
            22: { id: 22, name: "永恒", type: "tag", description: "永恒主题音乐" },
            23: { id: 23, name: "治愈", type: "tag", description: "治愈系音乐" },
            24: { id: 24, name: "安静", type: "tag", description: "安静舒缓的音乐" }
        };

        // 模拟评论数据库
        const commentsDatabase = {
            1: { id: 1, songId: 1, userId: 101, username: "音乐爱好者", content: "这首歌让我想起了夏天的美好时光！", time: "2023-05-10 14:30:22" },
            2: { id: 2, songId: 1, userId: 102, username: "K-pop粉丝", content: "TXT的新歌太好听了，循环播放中！", time: "2023-05-11 09:15:45" },
            3: { id: 3, songId: 2, userId: 103, username: "跑步达人", content: "跑步时听这首歌特别带劲！", time: "2023-05-12 18:22:10" },
            4: { id: 4, songId: 3, userId: 104, username: "动漫迷", content: "泽野弘之的音乐总是这么震撼！", time: "2023-05-13 21:05:33" },
            5: { id: 5, songId: 4, userId: 105, username: "Swiftie", content: "Taylor的这首歌太有力量了！", time: "2023-05-14 10:30:15" },
            6: { id: 6, songId: 5, userId: 106, username: "冬季恋人", content: "冬天的感觉完美体现在这首歌里！", time: "2023-05-15 15:45:22" }
        };

        // 模拟用户数据库
        const usersDatabase = {
            1: { id: 1, username: "admin", email: "admin@example.com", role: "admin", password: "123456", registerTime: "2023-01-01" },
            101: { id: 101, username: "音乐爱好者", email: "musiclover@example.com", role: "user", password: "music123", registerTime: "2023-01-15" },
            102: { id: 102, username: "K-pop粉丝", email: "kpopfan@example.com", role: "user", password: "kpop123", registerTime: "2023-02-20" },
            103: { id: 103, username: "跑步达人", email: "runner@example.com", role: "user", password: "run123", registerTime: "2023-03-05" },
            104: { id: 104, username: "动漫迷", email: "animefan@example.com", role: "editor", password: "anime123", registerTime: "2023-04-10" },
            105: { id: 105, username: "Swiftie", email: "swiftie@example.com", role: "user", password: "swift123", registerTime: "2023-04-15" },
            106: { id: 106, username: "冬季恋人", email: "winterlover@example.com", role: "user", password: "winter123", registerTime: "2023-04-20" }
        };

        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 确保推荐面板默认显示
            document.getElementById('recommendation-panel').style.display = 'block';

            // 隐藏所有管理员功能
            document.querySelectorAll('.admin-only').forEach(el => {
                el.style.display = 'none';
            });

            // 检查登录状态
            checkLoginStatus();

            // 初始化无限滚动
            initInfiniteScroll();
        });

        // 检查登录状态
        async function checkLoginStatus() {
            const token = localStorage.getItem('authToken');
            if (token) {
                const userId = parseInt(token.split('-')[1]);
                currentUser = usersDatabase[userId];
                if (currentUser) {
                    updateUIAfterLogin();
                    loadFavorites(); // 加载收藏列表
                }
            }
        }

        // 初始化无限滚动
        function initInfiniteScroll() {
            const observer = new IntersectionObserver((entries) => {
                if (entries[0].isIntersecting) {
                    loadMoreSongs();
                }
            }, { threshold: 0.1 });

            const trigger = document.querySelector('.load-more-trigger');
            if (trigger) {
                observer.observe(trigger);
            }
        }

        // 加载收藏歌曲
        function loadFavorites() {
            const favoritesGrid = document.getElementById('favorites-grid');
            const noFavorites = document.getElementById('no-favorites');

            favoritesGrid.innerHTML = '';

            const favoriteSongs = Object.values(songsDatabase).filter(song => song.isFavorite);

            if (favoriteSongs.length === 0) {
                noFavorites.style.display = 'block';
                return;
            }

            noFavorites.style.display = 'none';

            favoriteSongs.forEach(song => {
                const card = document.createElement('div');
                card.className = 'music-card';
                card.innerHTML = `
                    <div class="album-cover-container">
                        <img src="${song.cover}" alt="${song.title}" class="album-cover">
                    </div>
                    <div class="music-info">
                        <h3 class="song-title" onclick="showSongDetail(${song.id})">${song.title}</h3>
                        <div class="song-meta">
                            <span class="song-artist">${song.artist}</span>
                            <span class="song-album">${song.album}</span>
                        </div>
                        <div class="play-control">
                            <span class="duration">${song.duration}</span>
                            <button class="play-btn" onclick="playSong(${song.id}, '${song.title}', '${song.artist}')">
                                播放
                            </button>
                            <button class="favorite-btn favorited" onclick="toggleFavorite(${song.id}, this)">
                                ♥
                            </button>
                        </div>
                    </div>
                `;
                favoritesGrid.appendChild(card);
            });
        }

        // 加载更多歌曲
        function loadMoreSongs() {
            const trigger = document.querySelector('.load-more-trigger');
            trigger.innerHTML = '<div class="loading-spinner"></div> 加载中...';

            // 模拟加载延迟
            setTimeout(() => {
                trigger.innerHTML = '<div class="loading-spinner"></div> 加载更多...';
            }, 1000);
        }

        // 显示歌曲详情
        function showSongDetail(songId) {
            const song = songsDatabase[songId];
            if (!song) return;

            currentSong = song;

            // 获取这首歌的评论
            const songComments = Object.values(commentsDatabase).filter(comment => comment.songId === songId);

            // 创建评论HTML
            let commentsHTML = '';
            songComments.forEach(comment => {
                commentsHTML += `
                    <li class="comment-item">
                        <div class="comment-header">
                            <span class="comment-user">${comment.username}</span>
                            <span class="comment-time">${comment.time}</span>
                        </div>
                        <div class="comment-content">${comment.content}</div>
                        ${currentUser && (currentUser.role === 'admin' || currentUser.id === comment.userId) ? `<div class="comment-actions">
                            <span class="comment-action" onclick="editComment(${comment.id})">编辑</span>
                            <span class="comment-action" onclick="deleteComment(${comment.id})">删除</span>
                        </div>` : ''}
                    </li>
                `;
            });

            // 创建详情面板HTML
            const detailHTML = `
                <div class="back-to-list" onclick="backToList()">&larr; 返回列表</div>
                <div class="song-detail-header">
                    <img class="song-detail-cover" src="${song.cover}" alt="专辑封面">
                    <div class="song-detail-info">
                        <h1 class="song-detail-title">${song.title}</h1>
                        <h2 class="song-detail-artist">${song.artist}</h2>
                        <div class="song-detail-meta">
                            <div class="song-detail-meta-item">
                                <span class="song-detail-meta-label">专辑:</span>
                                <span class="song-detail-meta-value">${song.album}</span>
                            </div>
                            <div class="song-detail-meta-item">
                                <span class="song-detail-meta-label">时长:</span>
                                <span class="song-detail-meta-value">${song.duration}</span>
                            </div>
                            <div class="song-detail-meta-item">
                                <span class="song-detail-meta-label">流派:</span>
                                <span class="song-detail-meta-value">${song.genre}</span>
                            </div>
                            <div class="song-detail-meta-item">
                                <span class="song-detail-meta-label">分类:</span>
                                <span class="song-detail-meta-value">${song.categories.join(', ')}</span>
                            </div>
                            <div class="song-detail-meta-item">
                                <span class="song-detail-meta-label">标签:</span>
                                <span class="song-detail-meta-value">${song.tags.join(', ')}</span>
                            </div>
                        </div>
                        <div class="song-detail-actions">
                            <button class="play-btn" onclick="playSong(${song.id}, '${song.title}', '${song.artist}')">播放</button>
                            <button class="favorite-btn ${song.isFavorite ? 'favorited' : ''}" onclick="toggleFavorite(${song.id}, this)">
                                ${song.isFavorite ? '♥' : '♡'}
                            </button>
                        </div>
                    </div>
                </div>
                <div class="song-detail-content">
                    <div class="song-detail-lyrics">
                        ${song.lyrics}
                    </div>
                </div>
                <div class="comments-section">
                    <h3 class="comments-title">评论 (${songComments.length})</h3>
                    ${currentUser ? `
                    <div class="comment-form">
                        <textarea class="comment-input" id="newComment" placeholder="写下你的评论..."></textarea>
                        <button class="comment-submit" onclick="submitComment(${songId})">发表评论</button>
                    </div>
                    ` : ''}
                    <ul class="comment-list">
                        ${commentsHTML}
                    </ul>
                </div>
            `;

            // 更新推荐面板显示详情
            const panel = document.getElementById('recommendation-panel');
            panel.innerHTML = detailHTML;
        }

        // 提交评论
        function submitComment(songId) {
            if (!currentUser) {
                alert('请先登录');
                return;
            }

            const commentContent = document.getElementById('newComment').value.trim();
            if (!commentContent) {
                alert('评论内容不能为空');
                return;
            }

            // 创建新评论ID
            const newCommentId = Math.max(...Object.keys(commentsDatabase).map(Number)) + 1;

            // 获取当前时间
            const now = new Date();
            const formattedTime = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;

            // 添加新评论到数据库
            commentsDatabase[newCommentId] = {
                id: newCommentId,
                songId: songId,
                userId: currentUser.id,
                username: currentUser.username,
                content: commentContent,
                time: formattedTime
            };

            // 重新加载歌曲详情以显示新评论
            showSongDetail(songId);

            // 如果评论管理面板是打开的，也刷新它
            if (document.getElementById('comment-panel').style.display === 'block') {
                loadCommentManagementData();
            }

            alert('评论发表成功！');
        }

        // 编辑评论
        function editComment(commentId) {
            const comment = commentsDatabase[commentId];
            if (!comment) return;

            document.getElementById('commentId').value = commentId;
            document.getElementById('commentSongId').value = comment.songId;
            document.getElementById('commentContent').value = comment.content;
            document.getElementById('commentModalTitle').textContent = '编辑评论';

            document.getElementById('commentModal').style.display = 'block';
        }

        // 保存评论编辑
        function saveComment() {
            const commentId = parseInt(document.getElementById('commentId').value);
            const commentContent = document.getElementById('commentContent').value.trim();

            if (!commentContent) {
                alert('评论内容不能为空');
                return;
            }

            // 更新评论内容
            commentsDatabase[commentId].content = commentContent;

            // 关闭模态框
            closeCommentModal();

            // 重新加载歌曲详情或评论管理面板
            const songId = parseInt(document.getElementById('commentSongId').value);
            if (document.getElementById('recommendation-panel').style.display === 'block') {
                showSongDetail(songId);
            } else {
                loadCommentManagementData();
            }

            alert('评论更新成功！');
        }

        // 删除评论
        function deleteComment(commentId) {
            if (!confirm('确定要删除这条评论吗？')) return;

            const songId = commentsDatabase[commentId].songId;
            delete commentsDatabase[commentId];

            // 重新加载歌曲详情或评论管理面板
            if (document.getElementById('recommendation-panel').style.display === 'block') {
                showSongDetail(songId);
            } else {
                loadCommentManagementData();
            }

            alert('评论已删除');
        }

        // 关闭评论模态框
        function closeCommentModal() {
            document.getElementById('commentModal').style.display = 'none';
        }

        // 返回列表
        function backToList() {
            const panel = document.getElementById('recommendation-panel');
            panel.innerHTML = `
                <div class="recommendation-header">
                    <h1 class="recommendation-title">今日音乐推荐</h1>
                    <p class="recommendation-subtitle">发现最新最热的音乐作品</p>
                </div>
                <div class="music-grid">
                    <!-- 音乐卡片将通过JavaScript动态加载 -->
                </div>
                <div class="load-more-trigger">
                    <div class="loading-spinner"></div> 加载更多...
                </div>
            `;

            // 重新加载歌曲
            loadSongs();
            initInfiniteScroll();
        }

        // 播放歌曲
        function playSong(songId, title, artist) {
            const player = document.getElementById('globalPlayer');
            const songTitle = document.getElementById('currentSongTitle');
            const songArtist = document.getElementById('currentSongArtist');
            const audioPlayer = document.getElementById('audioPlayer');

            songTitle.textContent = title;
            songArtist.textContent = artist;
            player.style.display = 'block';

            // 使用模拟音频路径
            audioPlayer.src = songsDatabase[songId].audio;
            audioPlayer.play();
        }

        // 关闭播放器
        function closePlayer() {
            const player = document.getElementById('globalPlayer');
            const audioPlayer = document.getElementById('audioPlayer');

            audioPlayer.pause();
            player.style.display = 'none';
        }

        // 切换收藏状态
        function toggleFavorite(songId, element) {
            if (!currentUser) {
                alert('请先登录');
                return;
            }

            const song = songsDatabase[songId];
            song.isFavorite = !song.isFavorite;

            if (song.isFavorite) {
                element.innerHTML = '♥';
                element.classList.add('favorited');
            } else {
                element.innerHTML = '♡';
                element.classList.remove('favorited');
            }

            // 更新收藏列表
            loadFavorites();
        }

        // 打开认证模态框
        function openAuthModal(type = 'login') {
            const modal = document.getElementById('authModal');
            const modalTitle = document.getElementById('modalTitle');
            const confirmPasswordGroup = document.getElementById('confirmPasswordGroup');
            const authSubmitBtn = document.getElementById('authSubmitBtn');
            const toggleAuthFormBtn = document.getElementById('toggleAuthFormBtn');
            const toggleAuthFormText = document.getElementById('toggleAuthFormText');

            if (type === 'register') {
                modalTitle.textContent = '用户注册';
                confirmPasswordGroup.style.display = 'block';
                authSubmitBtn.textContent = '注册';
                toggleAuthFormText.textContent = '已有账号？';
                toggleAuthFormBtn.textContent = '立即登录';
            } else {
                modalTitle.textContent = '用户登录';
                confirmPasswordGroup.style.display = 'none';
                authSubmitBtn.textContent = '登录';
                toggleAuthFormText.textContent = '还没有账号？';
                toggleAuthFormBtn.textContent = '立即注册';
            }

            // 清空表单
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('confirmPassword').value = '';

            modal.style.display = 'block';
        }

        // 切换登录/注册表单
        function toggleAuthForm() {
            const modalTitle = document.getElementById('modalTitle');
            const confirmPasswordGroup = document.getElementById('confirmPasswordGroup');
            const authSubmitBtn = document.getElementById('authSubmitBtn');
            const toggleAuthFormBtn = document.getElementById('toggleAuthFormBtn');
            const toggleAuthFormText = document.getElementById('toggleAuthFormText');

            if (modalTitle.textContent === '用户登录') {
                // 切换到注册
                modalTitle.textContent = '用户注册';
                confirmPasswordGroup.style.display = 'block';
                authSubmitBtn.textContent = '注册';
                toggleAuthFormText.textContent = '已有账号？';
                toggleAuthFormBtn.textContent = '立即登录';
            } else {
                // 切换到登录
                modalTitle.textContent = '用户登录';
                confirmPasswordGroup.style.display = 'none';
                authSubmitBtn.textContent = '登录';
                toggleAuthFormText.textContent = '还没有账号？';
                toggleAuthFormBtn.textContent = '立即注册';
            }
        }

        // 提交认证表单
        function submitAuthForm() {
            const modalTitle = document.getElementById('modalTitle');
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            const confirmPassword = document.getElementById('confirmPassword').value.trim();

            if (!username || !password) {
                alert('用户名和密码不能为空');
                return;
            }

            if (modalTitle.textContent === '用户注册') {
                // 注册逻辑
                if (password !== confirmPassword) {
                    alert('两次输入的密码不一致');
                    return;
                }

                // 检查用户名是否已存在
                const existingUser = Object.values(usersDatabase).find(user => user.username === username);
                if (existingUser) {
                    alert('用户名已存在');
                    return;
                }

                // 创建新用户ID
                const newUserId = Math.max(...Object.keys(usersDatabase).map(Number)) + 1;

                // 获取当前时间
                const now = new Date();
                const formattedTime = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;

                // 添加新用户到数据库
                usersDatabase[newUserId] = {
                    id: newUserId,
                    username,
                    email: `${username}@example.com`, // 模拟邮箱
                    role: 'user',
                    password, // 实际应用中应该加密
                    registerTime: formattedTime
                };

                // 模拟token
                localStorage.setItem('authToken', `user-${newUserId}`);

                // 设置为当前用户
                currentUser = usersDatabase[newUserId];

                updateUIAfterLogin();
                closeAuthModal();
                alert('注册成功！');
            } else {
                // 登录逻辑
                const user = Object.values(usersDatabase).find(u => u.username === username && u.password === password);
                if (!user) {
                    alert('用户名或密码错误');
                    return;
                }

                // 模拟token
                localStorage.setItem('authToken', `user-${user.id}`);

                // 设置为当前用户
                currentUser = user;

                updateUIAfterLogin();
                loadFavorites(); // 加载收藏列表
                closeAuthModal();
                alert('登录成功！');
            }
        }

        // 关闭认证模态框
        function closeAuthModal() {
            document.getElementById('authModal').style.display = 'none';
        }

        // 登出功能
        function logout() {
            currentUser = null;
            localStorage.removeItem('authToken');
            updateUIAfterLogout();
            alert('已退出登录');
        }

        // 登录后更新UI
        function updateUIAfterLogin() {
            if (currentUser) {
                document.getElementById('userInfo').style.display = 'flex';
                document.getElementById('guestInfo').style.display = 'none';
                document.getElementById('userName').textContent = currentUser.username;
                document.getElementById('userAvatar').textContent = currentUser.username.charAt(0).toUpperCase();

                if (currentUser.role === 'admin') {
                    document.querySelectorAll('.admin-only').forEach(el => {
                        el.style.display = 'block';
                    });

                    // 加载管理面板数据
                    loadCategoryTagData();
                    loadCommentManagementData();
                    loadUserManagementData();
                    loadMusicManagementData();
                }
            }
        }

        // 登出后更新UI
        function updateUIAfterLogout() {
            document.getElementById('userInfo').style.display = 'none';
            document.getElementById('guestInfo').style.display = 'flex';
            document.querySelectorAll('.admin-only').forEach(el => {
                el.style.display = 'none';
            });

            // 重置收藏状态
            Object.values(songsDatabase).forEach(song => {
                song.isFavorite = false;
            });
        }

        // 打开分类标签模态框
        function openCategoryTagModal(categoryTagId = null) {
            const modal = document.getElementById('categoryTagModal');
            const modalTitle = document.getElementById('categoryTagModalTitle');
            const deleteBtn = document.getElementById('deleteCategoryTagBtn');

            if (categoryTagId) {
                // 编辑模式
                const categoryTag = categoryTagDatabase[categoryTagId];
                if (!categoryTag) return;

                modalTitle.textContent = '编辑分类/标签';
                document.getElementById('categoryTagId').value = categoryTagId;
                document.getElementById('categoryTagName').value = categoryTag.name;
                document.getElementById('categoryTagType').value = categoryTag.type;
                document.getElementById('categoryTagDescription').value = categoryTag.description;

                deleteBtn.style.display = 'inline-block';
            } else {
                // 添加模式
                modalTitle.textContent = '添加分类/标签';
                document.getElementById('categoryTagId').value = '';
                document.getElementById('categoryTagName').value = '';
                document.getElementById('categoryTagType').value = 'category';
                document.getElementById('categoryTagDescription').value = '';

                deleteBtn.style.display = 'none';
            }

            modal.style.display = 'block';
        }

        // 关闭分类标签模态框
        function closeCategoryTagModal() {
            document.getElementById('categoryTagModal').style.display = 'none';
        }

        // 保存分类标签
        function saveCategoryTag() {
            const id = document.getElementById('categoryTagId').value;
            const name = document.getElementById('categoryTagName').value.trim();
            const type = document.getElementById('categoryTagType').value;
            const description = document.getElementById('categoryTagDescription').value.trim();

            if (!name) {
                alert('名称不能为空');
                return;
            }

            if (id) {
                // 更新现有分类标签
                categoryTagDatabase[id] = {
                    ...categoryTagDatabase[id],
                    name,
                    type,
                    description
                };
            } else {
                // 创建新分类标签
                const newId = Math.max(...Object.keys(categoryTagDatabase).map(Number)) + 1;
                categoryTagDatabase[newId] = {
                    id: newId,
                    name,
                    type,
                    description
                };
            }

            closeCategoryTagModal();
            loadCategoryTagData();
            alert('保存成功！');
        }

        // 删除分类标签
        function deleteCategoryTag() {
            const id = document.getElementById('categoryTagId').value;
            if (!id || !confirm('确定要删除这个分类/标签吗？')) return;

            delete categoryTagDatabase[id];
            closeCategoryTagModal();
            loadCategoryTagData();
            alert('删除成功！');
        }

        // 加载分类标签数据
        function loadCategoryTagData() {
            const tableBody = document.getElementById('categoryTagTableBody');
            tableBody.innerHTML = '';

            Object.values(categoryTagDatabase).forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.id}</td>
                    <td>${item.name}</td>
                    <td>${item.type === 'category' ? '分类' : '标签'}</td>
                    <td>${item.description}</td>
                    <td>
                        <button class="action-btn edit-btn" onclick="openCategoryTagModal(${item.id})">编辑</button>
                        <button class="action-btn delete-btn" onclick="deleteCategoryTag(${item.id})">删除</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // 加载评论管理数据
        function loadCommentManagementData() {
            const tableBody = document.getElementById('commentTableBody');
            tableBody.innerHTML = '';

            Object.values(commentsDatabase).forEach(comment => {
                const song = songsDatabase[comment.songId] || { title: '未知歌曲' };
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${comment.id}</td>
                    <td>${song.title}</td>
                    <td>${comment.username}</td>
                    <td>${comment.content.length > 30 ? comment.content.substring(0, 30) + '...' : comment.content}</td>
                    <td>${comment.time}</td>
                    <td>
                        <button class="action-btn edit-btn" onclick="editComment(${comment.id})">编辑</button>
                        <button class="action-btn delete-btn" onclick="deleteComment(${comment.id})">删除</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // 打开用户模态框
        function openUserModal(userId = null) {
            const modal = document.getElementById('userModal');
            const modalTitle = document.getElementById('userModalTitle');
            const deleteBtn = document.getElementById('deleteUserBtn');

            if (userId) {
                // 编辑模式
                const user = usersDatabase[userId];
                if (!user) return;

                modalTitle.textContent = '编辑用户';
                document.getElementById('userId').value = userId;
                document.getElementById('userUsername').value = user.username;
                document.getElementById('userEmail').value = user.email;
                document.getElementById('userRole').value = user.role;

                deleteBtn.style.display = 'inline-block';
            } else {
                // 添加模式
                modalTitle.textContent = '添加用户';
                document.getElementById('userId').value = '';
                document.getElementById('userUsername').value = '';
                document.getElementById('userEmail').value = '';
                document.getElementById('userRole').value = 'user';

                deleteBtn.style.display = 'none';
            }

            modal.style.display = 'block';
        }

        // 关闭用户模态框
        function closeUserModal() {
            document.getElementById('userModal').style.display = 'none';
        }

        // 保存用户
        function saveUser() {
            const id = document.getElementById('userId').value;
            const username = document.getElementById('userUsername').value.trim();
            const email = document.getElementById('userEmail').value.trim();
            const role = document.getElementById('userRole').value;

            if (!username || !email) {
                alert('用户名和邮箱不能为空');
                return;
            }

            // 获取当前时间
            const now = new Date();
            const formattedTime = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;

            if (id) {
                // 更新现有用户
                usersDatabase[id] = {
                    ...usersDatabase[id],
                    username,
                    email,
                    role
                };
            } else {
                // 创建新用户
                const newId = Math.max(...Object.keys(usersDatabase).map(Number)) + 1;
                usersDatabase[newId] = {
                    id: newId,
                    username,
                    email,
                    role,
                    password: '123456', // 默认密码
                    registerTime: formattedTime
                };
            }

            closeUserModal();
            loadUserManagementData();
            alert('保存成功！');
        }

        // 删除用户
        function deleteUser() {
            const id = document.getElementById('userId').value;
            if (!id || !confirm('确定要删除这个用户吗？')) return;

            // 不能删除当前登录用户
            if (currentUser && currentUser.id == id) {
                alert('不能删除当前登录的用户');
                return;
            }

            delete usersDatabase[id];
            closeUserModal();
            loadUserManagementData();
            alert('删除成功！');
        }

        // 加载用户管理数据
        function loadUserManagementData() {
            const tableBody = document.getElementById('userTableBody');
            tableBody.innerHTML = '';

            Object.values(usersDatabase).forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.username}</td>
                    <td>${user.email}</td>
                    <td>${getRoleName(user.role)}</td>
                    <td>${user.registerTime}</td>
                    <td>
                        <button class="action-btn edit-btn" onclick="openUserModal(${user.id})">编辑</button>
                        <button class="action-btn delete-btn" onclick="deleteUser(${user.id})">删除</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // 获取角色名称
        function getRoleName(role) {
            const roleNames = {
                'admin': '管理员',
                'editor': '编辑',
                'user': '普通用户'
            };
            return roleNames[role] || role;
        }

        // 加载音乐管理数据
        function loadMusicManagementData() {
            const tableBody = document.getElementById('musicTableBody');
            tableBody.innerHTML = '';

            Object.values(songsDatabase).forEach(song => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${song.id}</td>
                    <td>${song.title}</td>
                    <td>${song.artist}</td>
                    <td>${song.album}</td>
                    <td>${song.genre}</td>
                    <td>
                        <button class="action-btn edit-btn" onclick="openMusicModal(${song.id})">编辑</button>
                        <button class="action-btn delete-btn" onclick="deleteMusic(${song.id})">删除</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // 打开音乐编辑模态框
        function openMusicModal(musicId = null) {
            const modal = document.getElementById('musicModal');
            const modalTitle = document.getElementById('musicModalTitle');
            const deleteBtn = document.getElementById('deleteMusicBtn');

            if (musicId) {
                // 编辑模式
                const music = songsDatabase[musicId];
                if (!music) return;

                modalTitle.textContent = '编辑音乐';
                document.getElementById('musicId').value = musicId;
                document.getElementById('musicTitle').value = music.title;
                document.getElementById('musicArtist').value = music.artist;
                document.getElementById('musicAlbum').value = music.album;
                document.getElementById('musicCover').value = music.cover;
                document.getElementById('musicAudio').value = music.audio;
                document.getElementById('musicDuration').value = music.duration;
                document.getElementById('musicGenre').value = music.genre;
                document.getElementById('musicLyrics').value = music.lyrics;

                deleteBtn.style.display = 'inline-block';
            } else {
                // 添加模式
                modalTitle.textContent = '添加音乐';
                document.getElementById('musicId').value = '';
                document.getElementById('musicTitle').value = '';
                document.getElementById('musicArtist').value = '';
                document.getElementById('musicAlbum').value = '';
                document.getElementById('musicCover').value = '';
                document.getElementById('musicAudio').value = '';
                document.getElementById('musicDuration').value = '';
                document.getElementById('musicGenre').value = '';
                document.getElementById('musicLyrics').value = '';

                deleteBtn.style.display = 'none';
            }

            modal.style.display = 'block';
        }

        // 关闭音乐模态框
        function closeMusicModal() {
            document.getElementById('musicModal').style.display = 'none';
        }

        // 保存音乐
        function saveMusic() {
            const id = document.getElementById('musicId').value;
            const title = document.getElementById('musicTitle').value.trim();
            const artist = document.getElementById('musicArtist').value.trim();
            const album = document.getElementById('musicAlbum').value.trim();
            const cover = document.getElementById('musicCover').value.trim();
            const audio = document.getElementById('musicAudio').value.trim();
            const duration = document.getElementById('musicDuration').value.trim();
            const genre = document.getElementById('musicGenre').value.trim();
            const lyrics = document.getElementById('musicLyrics').value.trim();

            if (!title || !artist || !album || !cover || !audio || !duration || !genre || !lyrics) {
                alert('所有字段都必须填写');
                return;
            }

            if (id) {
                // 更新现有音乐
                songsDatabase[id] = {
                    ...songsDatabase[id],
                    title,
                    artist,
                    album,
                    cover,
                    audio,
                    duration,
                    genre,
                    lyrics
                };
            } else {
                // 创建新音乐
                const newId = Math.max(...Object.keys(songsDatabase).map(Number)) + 1;
                songsDatabase[newId] = {
                    id: newId,
                    title,
                    artist,
                    album,
                    cover,
                    audio,
                    duration,
                    genre,
                    lyrics,
                    relatedSongs: [],
                    isFavorite: false,
                    categories: [],
                    tags: []
                };
            }

            closeMusicModal();
            loadMusicManagementData();
            alert('保存成功！');
        }

        // 删除音乐
        function deleteMusic(musicId) {
            if (!confirm('确定要删除这首音乐吗？')) return;

            delete songsDatabase[musicId];
            loadMusicManagementData();
            alert('删除成功！');
        }

        // 显示指定面板
        function showPanel(panelId) {
            // 隐藏所有面板
            document.querySelectorAll('.management-panel, #recommendation-panel').forEach(panel => {
                panel.style.display = 'none';
            });

            // 显示指定面板
            document.getElementById(panelId).style.display = 'block';

            // 如果是管理面板，加载相应数据
            if (panelId === 'category-tag-panel') {
                loadCategoryTagData();
            } else if (panelId === 'comment-panel') {
                loadCommentManagementData();
            } else if (panelId === 'user-panel') {
                loadUserManagementData();
            } else if (panelId === 'favorites-panel' && currentUser) {
                loadFavorites();
            } else if (panelId === 'music-panel') {
                loadMusicManagementData();
            }

            // 更新导航项active状态
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            const currentNavItem = document.querySelector(`.nav-item[onclick="showPanel('${panelId}')"]`);
            if (currentNavItem) {
                currentNavItem.classList.add('active');
            }
        }
    </script>
</body>
</html>